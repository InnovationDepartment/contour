{"version":3,"sources":["?","../src/scripts/header.js","../src/scripts/core/contour-utils.js","../src/scripts/core/contour.js","../src/scripts/core/axis/y-axis.js","../src/scripts/core/cartesian.js","../src/scripts/core/exportable.js","../src/scripts/version.js","../src/scripts/core/axis/axis-scale-factory.js","../src/scripts/core/axis/centered-y-axis.js","../src/scripts/core/axis/linear-scale-axis.js","../src/scripts/core/axis/log-y-axis.js","../src/scripts/core/axis/ordinal-scale-axis.js","../src/scripts/core/axis/smart-y-axis.js","../src/scripts/core/axis/time-scale-axis.js","../src/scripts/core/horizontal-frame.js","../src/scripts/core/visualization-container.js","../src/scripts/visualizations/area.js","../src/scripts/visualizations/bar.js","../src/scripts/visualizations/column.js","../src/scripts/visualizations/cool-narwhal.js","../src/scripts/visualizations/legend.js","../src/scripts/visualizations/line.js","../src/scripts/visualizations/null.js","../src/scripts/visualizations/pie.js","../src/scripts/visualizations/scatter.js","../src/scripts/visualizations/stack-tooltip.js","../src/scripts/visualizations/tooltip.js","../src/scripts/visualizations/trend-line.js"],"names":["exports","global","undefined","root","this","module","require","d3","_","Error","merge","multiplier","x","dig","nw","decDigits","Math","pow","maxMultiplier","a","b","max","addFloat","factor","aa","round","bb","subFloat","mulFloat","divFloat","noop","generalHelpers","getValue","src","deafult","ctx","args","Array","prototype","slice","call","arguments","apply","seriesNameToClass","name","dataFilters","cleanNullValues","series","map","s","extend","data","reduce","acum","datum","y","push","minMaxFilter","desiredLen","length","toReturn","index","increment","floor","hasValidPt","maxPt","minPt","maxIndex","min","intermediateIndex","intermediatePt","logging","warn","msg","console","log","numberHelpers","firstAndLast","ar","roundToNearest","number","multiple","ceil","roundTo","value","digits","trunc","str","abs","toString","parts","split","log10","LN10","clamp","val","l","h","clampLeft","low","clampRight","high","degToRad","deg","PI","radToDeg","rad","rotatePoint","point","cos","sin","translatePoint","delta","linearRegression","dataSrc","lr","n","sum_x","sum_y","sum_xy","sum_xx","sum_yy","i","slope","intercept","r2","sqrt","niceRound","axisHelpers","addAxis","axisCtor","axes","roundToNextTick","num","sign","mag","step","exp","toExponential","replace","raw","niceMinMax","ticks","startAtZero","tickValues","swap","origMax","isNumber","range","concat","exponent","defaultRounding","excelRoundUp","up","roundFn","v","nice","negativeMinAmount","intermediateMax","iMin","inter","roundToDigits","intermediateMin","interval","finalMin","finalMax","ticksValues","prevTick","j","newTick","defaultMinMax","minMax","foundSomethingRound","some","every","tick","extractScaleDomain","domain","zeroAnchor","dataMin","dataMax","niceTicks","filter","uniq","sortBy","calcXLabelsWidths","padding","compact","String","d","textBounds","width","doXLabelsFit","labelFormatter","options","tickWidths","availableWidthForLabels","chart","plotWidth","axisLabelsWidth","sum","getTicksThatFit","reduceTicksByMod","iter","filterMod","finalTicks","stringHelpers","text","css","body","document","getElementsByTagName","wrapper","createElement","dummy","className","style","position","height","visibility","lineHeight","whiteSpace","innerHTML","appendChild","res","clientWidth","clientHeight","removeChild","dateHelpers","dateDiff","d1","d2","diff","getTime","arrayHelpers","array1","array2","sort","isCorrectDataFormat","dataArray","isArray","p","hasOwnProperty","isCorrectSeriesFormat","isArrayOfObjects","isObject","hasDataArrayPerSeries","hasSeriesNamePerSeries","datumInCorrectFormat","normalizeSeries","categories","hasCategories","sortFn","normal","set","hasX","categoryAt","correctDataFormat","correctSeriesFormat","stackLayout","stack","layout","values","outFn","y0s","y0","out","array","cache","result","len","el","key","acc","cur","maxTickValues","tickInteval","isSupportedDataFormat","domHelpers","selectDom","selector","select","getStyle","elem","styles","offsetParent","ownerDocument","defaultView","getComputedStyle","getCentroid","element","getOffsetParent","t","tagName","parentNode","parentBox","getBoundingClientRect","bbox","left","top","debuggingHelpers","warning","defaults","animations","enable","duration","defaultWidth","defaultAspect","margin","right","bottom","internalPadding","rotatedFrame","plotHeight","plotTop","plotLeft","xAxis","yAxis","tooltip","Contour","init","export","ctorName","renderer","sortSeries","each","shouldSort","isDate","sortFunc","opt","vis","ownData","lastData","VisualizationContainer","_visualizations","expose","functionalityConstructor","ctor","functionality","Object","create","omit","_exposed","_extraOptions","calculateWidth","outerWidth","parseInt","paddingLeft","paddingRight","calculateHeight","outerHeight","paddingTop","paddingBottom","containerHeight","calcWidth","ratio","aspect","calcMetrics","adjustPadding","adjustTitlePadding","composeOptions","allDefaults","mergeExtraOptions","mergeDefaults","baseRender","plotArea","render","renderVisualizations","resize","container","update","chartOpt","attr","svg","append","node","createVisualizationLayer","id","type","visualization","layer","parent","bind","checkDependencies","listOfDependencies","_this","missing","dep","indexOf","join","ensureDefaults","isString","setData","invokeMap","dataNormalizer","define","amd","YAxis","setRange","scale","rangeSize","axis","scaling","numTicks","format","labels","formatter","_scale","tickFormat","tickSize","innerTickSize","outerTickSize","tickPadding","linear","setDomain","_niceTheScale","gridlines","maxTicks","title","titlePadding","innerRangePadding","outerRangePadding","orient","linearDomain","verticalAlign","cartesian","maxTickSize","readOnlyProps","extraPadding","xDomain","yDomain","_getYScaledDomain","opts","absMin","extent","smartAxis","xOptions","yOptions","_getAdjustedBottomPadding","_getAdjustedTopPadding","_getAdjustedLeftPadding","_getAdjustedRightPadding","xLabels","xAxisText","xLabelBounds","regularXBounds","em","ang","rotation","xLabelHeightUsed","yDomainScaled","tmpScale","yLabels","yAxisText","yLabelBounds","titleBounds","computeXScale","xScale","xScaleGenerator","xScaleFactory","rangeBand","computeYScale","yScaleDomain","yScale","yScaleGenerator","yScaleFactory","setYDomain","redrawYAxis","renderGridlines","_animationDuration","computeScales","_xAxis","_yAxis","renderXAxis","_xAxisGroup","selectAll","enter","transition","postProcessAxis","renderYAxis","_yAxisGroup","_renderYAxisElement","alignmentOffset","middle","renderAxisLabels","adjustFactor","bounds","option","horizontal","vertical","getYTicks","smart","pop","getXTicks","gr","w","lines","exit","remove","offset","renderBackground","background","g","adjustDomain","extents","getExtents","_adjustXDomain","_adjustYDomain","getXDomain","dataVis","flatten","isCategoricalData","dataSrcCategories","sameCats","intersection","yMin","yMax","field","all","defaultParams","fileName","target","backgroundColor","browser","checked","queue","working","exportable","cssIgnoreDiff","cssText","parentRule","cssSharedSvg","font","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","direction","letterSpacing","textDecoration","unicodeBidi","wordSpacing","clip","cursor","display","overflow","opacity","addToQueue","checkBrowser","download","exportImage","place","getSvgDataUrl","dataUrlCreated","makeSvgUrl","makeImageUrl","encodeBase64DataUrl","svgXml","btoa","dataUrlToBlob","dataUrl","byteString","atob","unescape","mimeString","byteArray","Uint8Array","charCodeAt","Blob","XMLSerializer","serializeToString","svgDataUrl","canvas","context","getContext","canvg","renderImageCanvg","renderImageNative","imageRendered","imageDataUrl","toDataURL","createsObjectUrls","imageBlob","domUrl","URL","webkitURL","objectUrl","createObjectURL","revokeObjectURL","svgImg","Image","onload","fillStyle","fillRect","drawImage","onerror","ignoreMouse","ignoreAnimation","offsetX","offsetY","scaleWidth","scaleHeight","renderCallback","createSvgClone","svgNode","svgCloned","createIsolatedNode","nodeClone","destroyIsolatedNode","cloneNodes","cloneLegendDiv","applyStyles","sourceNode","targetNode","sourceStyle","targetStyle","prop","isFinite","newNode","cloneNode","childNodes","childNode","nodeLoaded","iframe","iframeWindow","contentWindow","iframeDocument","destroyIframe","open","write","close","applyDivStylesToSvg","nodeName","rx","borderTopLeftRadius","ry","fill","stroke","borderLeftColor","stroke-width","borderLeftWidth","color","containerDiv","empty","containerDivNode","containerSvg","offsetLeft","clientLeft","offsetTop","clientTop","rect","entriesDivs","entryDivNode","entryDiv","entryDivKeyNode","getEntryDivSubNode","swatch","offsetWidth","offsetHeight","entryDivSeriesNode","textContent","getProportionedBounds","original","specified","exporter","startWork","boundsClone","performExport","svgNodeClone","destroySvgClone","setAttribute","win","aDownloads","savesMsBlobs","url","blob","revokeUrl","exporters","href","click","navigator","msSaveOrOpenBlob","location","doc","setTimeout","finishWork","img","fn","shift","checkEncodesBase64","checkADownloads","checkSavesMsBlobs","checkCreatesObjectUrls","checkExportsSvg","encodesBase64","setupBase64Shim","exportsSvg","querySelector","getAttribute","sourceImg","e","svgExportChecked","xml","encodeURIComponent","setupCanvgShim","chars","InvalidCharacterError","message","input","block","charCode","idx","output","charAt","done","scripts","remaining","script","head","version","helpers","isTimeData","TimeScale","LinearScale","OrdinalScale","axisType","LogYAxis","SmartYAxis","centered","CenteredYAxis","NUM_DECIMALS","__super","_extractYTickValues","scaledDomain","_getScaledDomain","dataRange","domainPadding","scaledMin","scaledMax","tickMin","tickMax","tickRange","tickSpacing","currentTick","_domain","_getAxisDomain","_setRange","formatLabel","getDate","labelsFit","optMin","optMax","ticksHint","isCategorized","ordinal","optFormat","axisGroup","pos","lineCenter","anchor","text-anchor","ref","toFixed","_range","band","numCats","threshold","rangeType","rangePoints","adjustedDomain","perTreshold","rawMax","nextTick","time","getOptimalTickFormat","axisDomain","spanDays","daysThreshold","_getAxisRange","rangeRound","size","frame","categoryLabels","xLabel","yLabel","lineHeightAdjustment","titleOneEm","_extent","maxs","mins","_stackedExtent","dataSets","ext","_xExtent","partialRight","_yExtent","VisInstanceContainer","setOptions","normalizeData","_updateDomain","isSupportedFormat","xExtent","yExtent","stacked","area","areaBase","preprocess","classFn","startArea","y1","smooth","interpolate","renderSeries","renderTooltipTrackers","trackerSize","markers","blocks","bar","barClass","groupPadding","barWidth","barRender","rectClass","chartOffset","grouped","bars","cssClass","numSeries","column","columnClass","columnWidth","rectStyle","dataKey","filteredData","cols","col","base","delay","legend","vAlign","hAlign","validAlignmentClasses","classes","Legend","firstChild","count","legendHeight","mid","positioner","selection","legendWidth","entries","line","animationDirection","marker","animationDelay","animationsMap","left-to-right","path","totalLength","getTotalLength","ease","bottom-to-top","rawData","shouldAnimate","renderPaths","renderMarkers","seriesClassName","extras","startLine","animFn","startLineFn","partial","dots","class","r","cx","cy","pie","sliceClass","piePadding","innerRadius","outerRadius","normalizePadding","clampBounds","maxWidth","maxHeight","calcPadding","resolveValueUnits","resolvePaddingUnits","shouldCenterX","shouldCenterY","pixelPadding","referenceSize","totalPadding","proposedRadius","radius","pieData","totalWidth","outerPaddingLeft","centerY","baseClass","translatePie","posY","pieGroup","group","arc","startArc","startAngle","endAngle","_current","attrTween","arcTween","scatter","ScatterPlot","halfRangeBand","stackTooltip","valueFormatter","classed","onMouseOver","isNull","mapFn","seriesName","filtered","html","onMouseOut","on","animate","showTime","hideTime","distance","clearHideTimer","clearTimeout","hideTimer","changeOpacity","tooltipElement","positionTooltip","pointOrCentroid","event","mouse","parseFloat","pointX","pointY","alignedRight","clampPosition","verticalPositioner","horizontalPositioner","show","getTooltipText","allPoints","match","params","list","rest","response","first","formatters","dataPoints","findOriginalDataPoint","seriesIndex","normalizeDataSet","dataSet","pluck","isLinear","normalizer","regression","numericDomain","lineY","isNaN"],"mappings":"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","file":"contour.min.js","sourcesContent":[null,"(function (undefined) {\n\n    var root = this;\n\n    if (typeof module === 'object' && module && typeof module.exports === 'object') {\n        if(typeof require === 'function') {\n            root.d3 = require('d3');\n            root._ = require('lodash');\n        }\n    }\n\n    if(!d3) throw new Error('You need to include d3.js before Contour. Go to http://d3js.org/');\n    if(!_ || !_.merge) throw new Error('You need to include lodash.js before Contour. Go to http://lodash.com/');\n\n})();\n","(function () {\n    // cheap trick to add decimals without hitting javascript issues\n    // note that this fails for very large numbers\n    var multiplier = function (x) { var dig = _.nw.decDigits(x); return dig === 0 ? 1 : Math.pow(10, dig); };\n    var maxMultiplier = function (a,b) { return Math.max(multiplier(a), multiplier(b)); };\n    var addFloat = function (a,b) { var factor = maxMultiplier(a,b), aa = Math.round(a * factor), bb = Math.round(b * factor); return (aa + bb) / factor; };\n    var subFloat = function (a,b) { var factor = maxMultiplier(a,b), aa = Math.round(a * factor), bb = Math.round(b * factor); return (aa - bb) / factor; };\n    var mulFloat = function (a,b) { var factor = maxMultiplier(a,b), aa = Math.round(a * factor), bb = Math.round(b * factor); return (aa * bb) / (factor*factor); };\n    var divFloat = function (a,b) { var factor = maxMultiplier(a,b), aa = Math.round(a * factor), bb = Math.round(b * factor); return aa / bb; };\n\n    var noop = function () {};\n\n    var generalHelpers = {\n        // the src is a function returns the function evaluated\n        // otherwise returns src\n        getValue: function (src, deafult, ctx, args) {\n            args = Array.prototype.slice.call(arguments, 3);\n            return !src ? deafult : typeof src === 'function' ? src.apply(ctx, args) : src;\n        },\n\n        seriesNameToClass: function (name) {\n            return name || '';\n        }\n    };\n\n    var dataFilters = {\n\n        cleanNullValues: function () {\n            return function (series) {\n                return _.map(series, function (s) {\n                    return _.extend(s, {\n                        data: _.reduce(s.data, function (acum, datum) {\n                            if (datum.y != null) {\n                                acum.push(datum);\n                            }\n\n                            return acum;\n                        }, [])\n                    });\n                });\n            };\n        },\n\n        minMaxFilter: function (desiredLen) {\n            return function(data) {\n                if (data.length <= desiredLen)\n                    return data;\n\n                var toReturn = [data[0]]; //always want the first\n                var index = 1;\n                var increment = Math.floor(data.length / desiredLen);\n\n                while (index < data.length - 1) {\n                    var hasValidPt = false;\n                    var maxPt;\n                    var minPt;\n                    var maxIndex = Math.min(index + increment, data.length);\n\n                    for (var intermediateIndex = index; intermediateIndex < maxIndex; intermediateIndex++) {\n                        var intermediatePt = data[index];\n                        if (intermediatePt.y) {\n                            if (!hasValidPt || intermediatePt.y > maxPt.y)\n                                maxPt = intermediatePt;\n\n                            if (!hasValidPt || intermediatePt.y < minPt.y)\n                                minPt = intermediatePt;\n\n                            hasValidPt = true;\n                        }\n                    }\n\n                    if (hasValidPt) {\n                        if (minPt.x === maxPt.x) {\n                            toReturn.push(minPt);\n                        } else if (minPt.x < maxPt.x) {\n                            toReturn.push(minPt);\n                            toReturn.push(maxPt);\n                        } else if (minPt.x > maxPt.x) {\n                            toReturn.push(maxPt);\n                            toReturn.push(minPt);\n                        }\n                    }\n\n                    index += Math.max(1, Math.min(data.length - 1 - index, increment));\n                }\n                toReturn.push(data[data.length - 1]); //always want the last\n                return toReturn;\n            };\n        }\n    };\n\n    var logging = {\n        warn: function (msg) {\n            if (console && console.log)\n                console.log(msg);\n        }\n    };\n\n    var numberHelpers = {\n        firstAndLast: function (ar) {\n            return [ar[0], ar[ar.length-1]];\n        },\n\n        roundToNearest: function (number, multiple) {\n            return mulFloat(Math.ceil(divFloat(number, multiple)), multiple);\n        },\n\n        roundTo: function (value, digits) {\n            return divFloat(Math.ceil(mulFloat(value, Math.pow(10, digits))), Math.pow(10, digits));\n        },\n\n        trunc: function (value) {\n            return value - value % 1;\n        },\n\n        // only works for integers\n        digits: function (value) {\n            var str = Math.abs(value).toString();\n            var parts = str.split('e');\n            if (parts.length === 2) {\n                return Math.max(0, parts[1]) + 1;\n            }\n            parts = str.split('.');\n            return parts[0].length;\n        },\n\n        decDigits: function (value) {\n            var str = Math.abs(value).toString();\n            var parts = str.split('.');\n            if (parts.length === 2) {\n                return parts[1].length;\n            }\n            parts = str.split('e');\n            if (parts.length === 2) {\n                return -Math.min(0, parts[1]);\n            }\n            return 0;\n        },\n\n        log10: function (value) {\n            return Math.log(value) / Math.LN10;\n        },\n\n        clamp: function (val, l, h) {\n            return val > h ? h : val < l ? l : val;\n        },\n\n        clampLeft: function (val, low) {\n            return val < low ? low : val;\n        },\n\n        clampRight: function (val, high) {\n            return val > high ? high : val;\n        },\n\n        degToRad: function (deg) {\n            return deg * Math.PI / 180;\n        },\n\n        radToDeg: function (rad) {\n            return rad * 180 / Math.PI;\n        },\n\n        rotatePoint: function (point, rad) {\n            return {\n                x: point.x * Math.cos(rad) - point.y * Math.sin(rad),\n                y: point.x * Math.sin(rad) + point.y * Math.cos(rad)\n            };\n        },\n\n        translatePoint: function (point, delta) {\n            return {\n                x: point.x + delta.x,\n                y: point.y + delta.y\n            };\n        },\n\n        linearRegression: function (dataSrc) {\n            var lr = {};\n            var n = dataSrc.length;\n            var sum_x = 0;\n            var sum_y = 0;\n            var sum_xy = 0;\n            var sum_xx = 0;\n            var sum_yy = 0;\n\n            for (var i = 0; i < n; i++) {\n                sum_x += dataSrc[i].x;\n                sum_y += dataSrc[i].y;\n                sum_xy += (dataSrc[i].x*dataSrc[i].y);\n                sum_xx += (dataSrc[i].x*dataSrc[i].x);\n                sum_yy += (dataSrc[i].y*dataSrc[i].y);\n            }\n\n            lr.slope = (n * sum_xy - sum_x * sum_y) / (n*sum_xx - sum_x * sum_x);\n            lr.intercept = (sum_y - lr.slope * sum_x)/n;\n            lr.r2 = Math.pow((n*sum_xy - sum_x*sum_y)/Math.sqrt((n*sum_xx-sum_x*sum_x)*(n*sum_yy-sum_y*sum_y)),2);\n\n            return lr;\n        },\n\n        niceRound: function (val) {\n            // for now just round(10% above the value)\n            return Math.ceil(val + val * 0.10);\n\n            // var digits = Math.floor(Math.log(val) / Math.LN10) + 1;\n            // var fac = Math.pow(10, digits);\n\n            // if(val < 1) return _.nw.roundToNearest(val, 1);\n\n            // if(val < fac / 2) return _.nw.roundToNearest(val, fac / 2);\n\n            // return _.nw.roundToNearest(val, fac);\n        }\n    };\n\n    var axisHelpers = {\n        addAxis: function (name, axisCtor) {\n            _.nw.axes = _.nw.axes || {};\n            _.nw.axes[name] = axisCtor;\n        },\n\n        roundToNextTick: function (num) {\n            var abs = Math.abs(num);\n            var sign = abs === num ? 1 : -1;\n            var mag, step;\n            if (abs >= 1) {\n                mag = Math.floor(_.nw.log10(abs));\n                step = mag <= 1 ? 2 : Math.pow(10, mag - 1);\n            } else {\n\n                var exp = abs.toExponential().replace(/\\.|e-\\d+$/g, '');\n                mag = exp.length;\n                step = mulFloat((mag === 1 ? 2 : 10), Math.pow(10, -mag));\n            }\n\n            var raw = _.nw.roundToNearest(abs, step);\n            return sign * raw;\n        },\n\n        niceMinMax: function (min, max, ticks, startAtZero) {\n            // return divFloat(Math.ceil(mulFloat(value, Math.pow(10, digits))), Math.pow(10, digits));\n\n            // check for errors... min cannot be > max\n            if (min > max) {\n                return {\n                    min: min,\n                    max: min,\n                    tickValues: []\n                };\n            }\n\n            var swap = max < 0 && min < 0;\n            var origMax = max;\n            if (swap) {\n                max = -min;\n                min = -origMax;\n            }\n\n            // 2 ticks seem to work for min max and passing 5 ticks to d3\n            ticks = ticks == null ? 2 : Math.max(1, ticks);\n            // if ticks is an array, use that as order of preferred ticks; otherwise return a\n            // variable number of ticks in order to keep values round\n            if (_.isNumber(ticks)) {\n                // for 1, check [1]\n                // for 2, check [2, 1]\n                // for 3, check [3, 2]\n                // for 4, check [4, 5, 3]\n                // for 5, check [5, 6, 4, 3]\n                // for 6, check [6, 7, 5, 4]\n                // for 7, check [7, 8, 6, 5]\n                // for 8, check [8, 9, 10, 7, 6]\n                // for 9, check [9, 10, 11, 8, 7, 6]\n                // for 10, check [10, 11, 12, 9, 8, 7]\n                ticks = _.range(ticks, ticks * 1.28)\n                    .concat(_.range(ticks - 1, (ticks - 1) * 0.72, -1));\n            }\n\n            if (startAtZero == null) {\n                startAtZero = min === 0 || origMax < 0;\n            }\n\n            var exponent;\n            if (min === max) {\n                if (max === 0) {\n                    exponent = -1.0;\n                } else {\n                    exponent = numberHelpers.log10(Math.abs(max));\n                }\n            } else {\n                if(startAtZero) {\n                    exponent = numberHelpers.log10(Math.abs(max)) - 0.5;\n                } else {\n                    exponent = numberHelpers.log10(max-min) - 0.5;\n                }\n            }\n\n            var defaultRounding = -(exponent >= 0 ? numberHelpers.trunc(exponent) : Math.floor(exponent));\n\n            // var defaultRounding = -numberHelpers.trunc((min === max ?\n            //     max === 0 ? -1.0 : numberHelpers.log10(Math.abs(max)) :\n            //     startAtZero ? numberHelpers.log10(Math.abs(max)) : numberHelpers.log10(max-min)\n            // ) - 0.5);\n\n            var excelRoundUp = function (value, up) {\n                up = up != null ? up : 0;\n                var roundFn = function (v) { return v >= 0 ? Math.ceil(v) : Math.floor(v); };\n                return divFloat(roundFn(value * Math.pow(10, up)), Math.pow(10, up));\n            };\n\n            var nice = function (ticks) {\n                var negativeMinAmount = excelRoundUp(Math.max(0, -min) / ticks, defaultRounding - 1);\n\n                var intermediateMax = min === max ? max === 0 ? 1 : excelRoundUp(max + negativeMinAmount, defaultRounding)\n                    : excelRoundUp(max + negativeMinAmount,defaultRounding);\n\n                var iMin = 0;\n                if (!startAtZero && min !== max) {\n                    var inter = min + negativeMinAmount;\n                    var dig = numberHelpers.digits(inter);\n                    var roundToDigits;\n                    if (inter > 0) {\n                        roundToDigits =  -Math.floor(_.nw.log10(inter));\n                    } else {\n                        roundToDigits = (Math.max(1, Math.abs(dig-2)));\n                    }\n\n                    iMin = -numberHelpers.roundTo(-inter, roundToDigits);\n                    iMin = iMin === 0 ? 0 : iMin;\n                    // old version:\n                    // iMin = excelRound(min + negativeMinAmount, defaultRounding + (min < 0 ? 1 : 0))\n                }\n\n                var intermediateMin = iMin;\n\n                var interval = excelRoundUp(divFloat(subFloat(intermediateMax, intermediateMin),ticks), defaultRounding);\n                var finalMin = subFloat(intermediateMin, negativeMinAmount);\n                var finalMax = addFloat(finalMin, mulFloat(ticks, interval));\n                var ticksValues = [finalMin];\n                var prevTick = finalMin;\n\n                for (var j=1; j < ticks; j++) {\n                    var newTick = addFloat(prevTick, interval);\n\n                    ticksValues.push(newTick);\n                    prevTick = newTick;\n                }\n\n                // total ticks are going to be either ticks or ticks + 1\n                if (Math.abs(prevTick - finalMax) > 1e-10) {\n                    ticksValues.push(finalMax);\n                }\n\n                return {\n                    min: swap ? -finalMax : finalMin,\n                    max: swap ? -finalMin : finalMax,\n                    tickValues: ticksValues.map(function (a) { return swap ? -a : a; })\n                };\n            };\n\n            var defaultMinMax;\n            var minMax;\n\n            var foundSomethingRound = _.some(ticks, function (ticks) {\n                minMax = nice(ticks);\n                defaultMinMax = defaultMinMax || minMax;\n                return _.every(minMax.tickValues, function (tick) {\n                    return tick === Math.round(tick);\n                });\n            });\n            return foundSomethingRound ? minMax : defaultMinMax;\n        },\n\n        /*jshint eqnull:true */\n        extractScaleDomain: function (domain, min, max, ticks, zeroAnchor) {\n            var dataMin = min != null ? min : _.min(domain);\n            var dataMax = max != null ? max : _.max(domain);\n            ticks = ticks == null ? 5 : ticks;\n\n            var niceMinMax = axisHelpers.niceMinMax(dataMin, dataMax, ticks, zeroAnchor);\n\n            // return [niceMinMax.min, niceMinMax.max];\n\n            // // we want null || undefined for all this comparasons\n            // // that == null gives us\n            if (min == null && max == null) {\n                return [niceMinMax.min, niceMinMax.max];\n            }\n\n            if (min == null) {\n                return [Math.min(niceMinMax.min, max), max];\n            }\n\n            if (max == null) {\n                return [min, Math.max(min, niceMinMax.max)];\n            }\n\n            return [min, max];\n        },\n\n        niceTicks: function (min, max, ticks, zeroAnchor, domain) {\n            ticks = ticks == null ? 5 : ticks;\n            min = min != null ? min : zeroAnchor ? Math.min(0, domain[0]) : domain[0];\n            max = max != null ? max : domain[1];\n\n            var niceMinMax = axisHelpers.niceMinMax(min, max, ticks, zeroAnchor);\n            var tickValues = niceMinMax.tickValues;\n\n            // ensure that y-axis endpoints are labelled\n            if (min !== domain[0]) {\n                tickValues.push(min);\n                tickValues = tickValues.filter(function(tick) {\n                    return tick >= min;\n                });\n            }\n\n            if (max !== domain[1]) {\n                tickValues.push(max);\n                tickValues = tickValues.filter(function(tick) {\n                    return tick <= max;\n                });\n            }\n\n            return _.uniq(_.sortBy(tickValues));\n        },\n\n        calcXLabelsWidths: function (ticks) {\n            var padding = 8;\n            return _.compact(ticks).map(String).map(function (d) {\n                if (!d) {\n                    return padding * 2;\n                }\n                return _.nw.textBounds(d, '.x.axis text').width + (padding * 2);\n            });\n        },\n\n        doXLabelsFit: function (ticks, labelFormatter, options) {\n            var tickWidths = _.nw.calcXLabelsWidths(ticks.map(labelFormatter));\n            var availableWidthForLabels = (options.chart.plotWidth + tickWidths[0] / 2 + tickWidths[ticks.length - 1] / 2);\n            var axisLabelsWidth = _.nw.sum(tickWidths);\n            return axisLabelsWidth <= availableWidthForLabels;\n        },\n\n        getTicksThatFit: function (ticks, labelFormatter, options) {\n            // reduce the number of ticks incrementally by taking every 2nd, then every 3th, and so on\n            // until we find a set of ticks that fits the available space\n            function reduceTicksByMod() {\n                var tickWidths = _.nw.calcXLabelsWidths(ticks.map(labelFormatter));\n                var axisLabelsWidth = _.nw.sum(tickWidths);\n                var availableWidthForLabels = (options.chart.plotWidth + tickWidths[0] / 2 + tickWidths[ticks.length - 1] / 2);\n                var iter = 1;\n                var filterMod = function (d, i) { return (i % iter) === 0; };\n                var finalTicks = ticks;\n                while(axisLabelsWidth > availableWidthForLabels && finalTicks.length !== 0) {\n                    iter++;\n                    finalTicks = _.filter(ticks, filterMod);\n                    axisLabelsWidth = _.nw.sum(_.nw.calcXLabelsWidths(finalTicks.map(labelFormatter)));\n                }\n\n                return finalTicks;\n            }\n\n            // possible alternative way using d3 ticks to calculate the number\n            // that fits\n            // function reduceTicksByD3() {\n            //     // while(axisLabelsWidth > availableWidthForLabels && ticks.length !== 1) {\n            //     //     ticks = axis.scale().ticks(Math.floor(--numAutoTicks));\n            //     //     axisLabelsWidth = sum(calcLabelsWidths(ticks.map(formatLabel)));\n            //     // }\n\n            //     // axis.ticks(ticks.length);\n            // }\n\n            return reduceTicksByMod();\n        }\n    };\n\n\n    var stringHelpers = {\n        // measure text inside a Contour chart container\n        textBounds: function (text, css) {\n            var body = document.getElementsByTagName('body')[0];\n            var wrapper = document.createElement('span');\n            var dummy = document.createElement('span');\n            wrapper.className = 'contour-chart';\n            dummy.style.position = 'absolute';\n            dummy.style.width = 'auto';\n            dummy.style.height = 'auto';\n            dummy.style.visibility = 'hidden';\n            dummy.style.lineHeight = '100%';\n            dummy.style.whiteSpace = 'nowrap';\n\n            dummy.innerHTML = text;\n            dummy.className = css.replace(/\\./g, ' ');\n            wrapper.appendChild(dummy);\n            body.appendChild(wrapper);\n            var res = { width: dummy.clientWidth, height: dummy.clientHeight };\n            wrapper.removeChild(dummy);\n            body.removeChild(wrapper);\n            return res;\n        }\n    };\n\n    var dateHelpers = {\n        dateDiff: function(d1, d2) {\n            var diff = d1.getTime() - d2.getTime();\n            return diff / (24*60*60*1000);\n        }\n    };\n\n    var arrayHelpers = {\n        // concatenate and sort two arrays to the resulting array\n        // is sorted ie. merge [2,4,6] and [1,3,5] = [1,2,3,4,5,6]\n        merge: function (array1, array2) {\n            if(typeof(array1) === 'number') array1 = [array1];\n            if(typeof(array2) === 'number') array2 = [array2];\n            if(!array1 || !array1.length) return array2;\n            if(!array2 || !array2.length) return array1;\n\n            return [].concat(array1, array2).sort(function (a,b) { return a-b; });\n        },\n\n        isCorrectDataFormat: function (dataArray) {\n            return _.isArray(dataArray) && _.every(dataArray, function (p) { return p.hasOwnProperty('x') && p.hasOwnProperty('y'); });\n        },\n\n        isCorrectSeriesFormat: function (data) {\n            var isArrayOfObjects = _.isArray(data) && _.isObject(data[0]);\n            var hasDataArrayPerSeries = _.every(data, function (d) { return d.hasOwnProperty('data'); });\n            var hasSeriesNamePerSeries = _.every(data, function (d) { return d.hasOwnProperty('name'); });\n            var datumInCorrectFormat = isArrayOfObjects && hasDataArrayPerSeries && arrayHelpers.isCorrectDataFormat(data[0].data);\n\n            return isArrayOfObjects && hasDataArrayPerSeries && hasSeriesNamePerSeries && datumInCorrectFormat;\n        },\n\n        /*jshint eqnull:true */\n        // we are using != null to get null & undefined but not 0\n        normalizeSeries: function (data, categories) {\n            var hasCategories = !!(categories && _.isArray(categories));\n            function sortFn(a, b) { return a.x - b.x; }\n            function normal(set, name) {\n                var d = {\n                    name: name,\n                    data: _.map(set, function (d, i) {\n                        var hasX = d != null && d.hasOwnProperty('x');\n                        var val = function (v) { return v != null ? v : null; };\n                        // make sure we return a valid category and not cast nulls as string\n                        var categoryAt = function (i) { return !hasCategories ? i : categories[i] == null ? null : categories[i] + ''; };\n                        return hasX ? _.extend(d, { x: d.x, y: val(d.y) }) : { x: categoryAt(i), y: val(d) };\n                    })\n                };\n\n                if (!hasCategories) {\n                    d.data.sort(sortFn);\n                }\n\n                return d;\n            }\n\n            var correctDataFormat = arrayHelpers.isCorrectDataFormat(data);\n            var correctSeriesFormat = arrayHelpers.isCorrectSeriesFormat(data);\n\n            // do not make a new copy, if the data is already in the correct format!\n            if (correctSeriesFormat) {\n                return data;\n            }\n\n            // do the next best thing if the data is a set of points in the correct format\n            if (correctDataFormat) {\n                if (!hasCategories) data.sort(sortFn);\n                return [{ name: 'series 1', data: data }];\n            }\n\n            // for the rest of the cases we need to normalize to the full format of the series\n            if (_.isArray(data)) {\n                if ((_.isObject(data[0]) && data[0].hasOwnProperty('data')) || _.isArray(data[0])) {\n                    // this would be the shape for multiple series\n                    return _.map(data, function (d, i) { return normal(d.data ? d.data : d, d.name ? d.name : 'series ' + (i+1)); });\n                } else {\n                    // this is just the shape [1,2,3,4] or [{x:0, y:1}, { x: 1, y:2}...]\n                    return [normal(data, 'series 1')];\n                }\n            }\n\n            // nothing to do to the data if it's not in a supported format\n            return data;\n        },\n\n        // returns a function to format the data into a 'stacked' d3 layout\n        // passing in a series data will add a y0 to each data point\n        // where the point should start relative to the reset of the series points\n        // at that x value\n        stackLayout: function () {\n            var stack = d3.layout\n                .stack()\n                .values(function (d) { return d.data; });\n            // prepare satck to handle different x values with different lengths\n            var outFn = function() {\n                var y0s = {};\n                return function (d, y0, y) {\n                    d.y0 = y0s[d.x] != null ? y0s[d.x] : 0;\n                    d.y = y;\n                    y0s[d.x] = (y0s[d.x] || 0) + y;\n                };\n            };\n\n            stack.out(outFn());\n\n            return stack;\n        },\n\n        // return the uniq elements in the array\n        // we are implementing our own version since this algorithm seems\n        // to be a lot faster than what lodash uses\n        uniq: function (array) {\n            var cache = {}, result = [];\n            var len = array.length;\n\n            for (var j=0; j<len; j++) {\n                var el = array[j], key = el + '';\n\n                if (!cache.hasOwnProperty(key)) {\n                    cache[key] = true;\n                    result.push(el);\n                }\n            }\n\n            return result;\n        },\n\n        sum: function (array) {\n            return _.reduce(array, function (acc, cur) { return acc += cur; }, 0);\n        },\n\n        maxTickValues: function (max, domain) {\n            var len = domain.length;\n            var values = [];\n\n            if (max >= len) return domain.slice();\n\n            // return d3.scale.linear().domain(domain).ticks(max);\n\n            var tickInteval = Math.ceil((len) / (max));\n            var cur = 0;\n            while (cur < len) {\n                values.push(domain[cur]);\n                cur += tickInteval;\n            }\n\n            return values;\n        },\n\n        isSupportedDataFormat: function (data) {\n            // this covers all supported formats so far:\n            // [ {data: [...] }, ... ]\n            // [ [...], [...] ]\n            return _.isArray(data) &&\n                (_.isObject(data[0]) && data[0].hasOwnProperty('data') && _.isArray(data[0].data)) ||\n                _.isArray(data[0]);\n        }\n\n    };\n\n    var domHelpers = {\n        selectDom: function (selector) {\n            return d3.select(selector)[0][0];\n        },\n\n        getStyle: function (el, style) {\n            if(!el) return undefined;\n            var elem = typeof el === 'string' ? this.selectDom(el) : el;\n            // we need a good way to check if the element is detached or not\n            var styles = elem.offsetParent ? elem.ownerDocument.defaultView.getComputedStyle(elem, null) : elem.style;\n\n            return style ? styles[style] : styles;\n        },\n\n        getCentroid: function (element) {\n            var getOffsetParent = function () {\n                if (element.offsetParent) {\n                    return element.offsetParent;\n                }\n\n                // we we don't have an offsetParent, we may be in firefox\n                // let's just assume that the offset parent is the svg element\n                var t = element;\n                while(t && t.tagName !== 'svg') {\n                    t = t.parentNode;\n                }\n\n                return t;\n            };\n\n            var parentBox = getOffsetParent().getBoundingClientRect();\n            var bbox = element.getBoundingClientRect();\n\n            return [bbox.left - parentBox.left + bbox.width/2, bbox.top - parentBox.top + bbox.height/2];\n        }\n    };\n\n    var debuggingHelpers = {\n        warning: function (msg) {\n            if(console && console.log) {\n                console.log('WARNING: ' + msg);\n            }\n        }\n    };\n\n    _.nw = _.extend({}, _.nw, numberHelpers, arrayHelpers, stringHelpers, dateHelpers,\n        axisHelpers, debuggingHelpers, domHelpers, generalHelpers, logging, dataFilters);\n\n    if (!_.noop) {\n        _.noop = noop;\n    }\n\n})();\n","(function () {\n\n    var root = this;\n\n    var defaults = {\n\n        chart: {\n            animations: {\n                enable: true,\n                // duration of the animation in ms\n                duration: 400,\n            },\n            // by default take the size of the parent container\n            defaultWidth: 400,\n            // height = width * ratio\n            defaultAspect: 1 / 1.61803398875,\n            // calculated at render time based on the options & container\n            width: undefined,\n            // if defined, height takes precedence over aspect\n            height: undefined,\n            // margin between the container and the chart (ie labels or axis title)\n            margin: {\n                top: 0,\n                right: 0,\n                bottom: 0,\n                left: 0\n            },\n            // padding between the chart area and the inner plot area */\n            padding: {\n                top: null,\n                right: null,\n                bottom: null,\n                left: null\n            },\n            internalPadding: {\n                bottom: 0,\n                left: 0\n            },\n            // automatically false by default anyway; adding here to help generate docs\n            rotatedFrame: false,\n            // width in pixels of the plot area (area inside the axis if any). This gets calculated on render\n            plotWidth: undefined,\n            // height in pixels of the plot area (area inside the axis if any). This gets calculated on render\n            plotHeight: undefined,\n            // top edge in pixels (from the edge of the svg) of the plot area (area inside the axis if any). This gets calculated on render\n            plotTop: undefined,\n            // left edge in pixels (from the edge of the svg) of the plot area (area inside the axis if any). This gets calculated on render\n            plotLeft: undefined,\n        },\n\n        xAxis: {\n        },\n\n        yAxis: {\n        },\n\n        tooltip: {\n        }\n    };\n\n    /**\n    * Creates a Contour instance, based on the core Contour visualizations object. This instance can contain a set of related visualizations.\n    *\n    *   * Pass the constructor any configuration options in the *options* parameter. Make sure the `el` option contains the selector of the container in which the Contour instance will be rendered.\n    *   * Set the frame for this Contour instance (e.g. `.cartesian()`).\n    *   * Add one or more specific visualizations to this Contour instance (e.g. `.scatter()`, `.trend-line()`). Pass each visualization constructor the data it displays. Pass configuration options if desired.\n    *   * Invoke an action for this Contour instance (e.g. `.render()`).\n    *\n    * ### Example:\n    *\n    *     new Contour({el: 'myChart'})\n    *       .cartesian()\n    *       .line([1,3,2,5])\n    *       .render()\n    *\n    *\n    * @class Contour()\n    * @param {object} options The global configuration options object\n    *\n    */\n    function Contour (options) {\n        this.init(options);\n\n        return this;\n    }\n\n    /**\n    * Adds a new kind of visualization to the core Contour object.\n    * The *renderer* function is called when you add this visualization to instances of Contour.\n    * See a sample in the [Contour Gallery](http://forio.com/contour/gallery.html#/chart/pie/pie-gauge).\n    *\n    * ### Example:\n    *\n    *     Contour.export(\"exampleVisualization\", function(data, layer) {\n    *           //function body to create exampleVisualization\n    *           //for example using SVG and/or D3\n    *     });\n    *\n    *     //to include the visualization into a specific Contour instance\n    *     new Contour(options)\n    *           .exampleVisualization(data)\n    *           .render()\n    *\n    * @param {String} ctorName Name of the visualization, used as a constructor name.\n    * @param {Function} renderer Function called when this visualization is added to a Contour instance. This function receives the data that is passed in to the constructor.\n    */\n    Contour.export = function (ctorName, renderer) {\n\n        if (typeof renderer !== 'function') throw new Error('Invalid render function for ' + ctorName + ' visualization');\n\n        function sortSeries(data) {\n            if(!data || !data.length) return [];\n\n            if(data[0].data) {\n                _.each(data, sortSeries);\n            }\n\n            var shouldSort = _.isObject(data[0]) && _.isDate(data[0].x);\n            var sortFunc = function (a, b) { return a.x - b.x; };\n            if(shouldSort) {\n                data.sort(sortFunc);\n            }\n\n            return data;\n        }\n\n        Contour.prototype[ctorName] = function (data, options) {\n            var categories = this.options ? this.options.xAxis ? this.options.xAxis.categories : undefined : undefined;\n            var opt =  _.extend({}, this.options[ctorName], options);\n            var vis;\n            var ownData = true;\n\n            if (!data) {\n                data = this.lastData || [];\n                ownData = false;\n            }\n\n            sortSeries(data);\n            vis = new Contour.VisualizationContainer(data, categories, opt, ctorName, renderer, this);\n            vis.ownData = ownData;\n            this._visualizations.push(vis);\n\n            // lastData is used to pass the last specified dataset\n            // to the next visualiaztion in the chain wihtout\n            // the need to specify it again.... this allows you to do\n            // new Contour().cartesian().line(dataset).lengend().tooltip().render()\n            // and legend and tooltip will recieve dataset\n            this.lastData = data;\n\n            return this;\n        };\n\n        /* expose the renderer function so it can be reused\n        * by other visualizations though the constructor function\n        * ie. Contour.export('customLineChart', function (data, layer, options) {\n        *       // call the line chart directly\n        *       return this.line.renderer(data, layer, options);\n        *    });\n        */\n        Contour.prototype[ctorName].renderer = renderer;\n    };\n\n\n    /**\n    * Exposes functionality to the core Contour object.\n    * Use this to add *functionality* that will be available for any visualizations.\n    *\n    * ###Example:\n    *\n    *     Contour.expose('example', function ctor(params) {\n    *         // params are the parameters passed into the constructor function\n    *         return {\n    *             // the init function, if provided, is called automatically upon instantiation of the functionality\n    *             // the options parameter has the global Contour options object\n    *             init: function (options) { ... },\n    *\n    *             // when included in the instance, the function `.myFunction` is available in the visualizations\n    *             myFunction: function(data) { .... }\n    *         };\n    *     });\n    *\n    *     Contour.export('visualizationThatUsesMyFunction', function(data, layer) {\n    *           //function body including call to this.myFunction(data)\n    *     });\n    *\n    *     // to include the functionality into a specific instance\n    *     new Contour(options)\n    *           .example({ text: 'someText' })\n    *           .visualizationThatUsesMyFunction()\n    *           .render()\n    *\n\n    */\n    Contour.expose = function (ctorName, functionalityConstructor) {\n        var ctor = function () {\n            var functionality = functionalityConstructor;\n            if (typeof functionalityConstructor === 'function') {\n                functionality = Object.create(functionalityConstructor);\n                functionality = functionalityConstructor.apply(functionality, arguments);\n            }\n\n            // extend the --instance-- we don't want all charts to be overriden...\n            _.extend(this, _.omit(functionality, 'init'));\n\n            if(functionality.init) {\n                functionality.init.call(this, this.options);\n            }\n\n            // keep a list of the included functionality into this instance\n            // so we can match and check dependencies\n            this._exposed.push(ctorName);\n\n            return this;\n        };\n\n        Contour.prototype[ctorName] = ctor;\n\n        return this;\n    };\n\n    Contour.prototype = _.extend(Contour.prototype, {\n        _visualizations: undefined,\n\n        _extraOptions: undefined,\n\n        _exposed: undefined,\n\n        // Initializes the instance of Contour\n        init: function (options) {\n            // for now, just  store this options here...\n            // the final set of options will be composed before rendering\n            // after all components/visualizations have been added\n            this.options = options || {};\n\n            this._extraOptions = [];\n            this._visualizations = [];\n            this._exposed = [];\n\n            return this;\n        },\n\n        calculateWidth: function () {\n\n            // assume all in pixel units and border-box box-sizing\n            var outerWidth = parseInt(_.nw.getStyle(this.options.el, 'width') || 0, 10);\n            var paddingLeft = parseInt(_.nw.getStyle(this.options.el, 'padding-left') || 0, 10);\n            var paddingRight = parseInt(_.nw.getStyle(this.options.el, 'padding-right') || 0, 10);\n\n            var width = outerWidth - paddingRight - paddingLeft;\n\n            return this.options.el ? (width || this.options.chart.defaultWidth) : this.options.chart.defaultWidth;\n        },\n\n        calculateHeight: function () {\n            // assume all in pixel units and border-box box-sizing\n            var outerHeight = parseInt(_.nw.getStyle(this.options.el, 'height') || 0, 10);\n            var paddingTop = parseInt(_.nw.getStyle(this.options.el, 'padding-top') || 0, 10);\n            var paddingBottom = parseInt(_.nw.getStyle(this.options.el, 'padding-bottom') || 0, 10);\n            var height = outerHeight - paddingTop - paddingBottom;\n\n            var containerHeight = this.options.el ? height : undefined;\n            var calcWidth = this.options.chart.width;\n            var ratio = this.options.chart.aspect || this.options.chart.defaultAspect;\n\n            return !!containerHeight && containerHeight > 1 ?  containerHeight : Math.round(calcWidth * ratio);\n        },\n\n        calcMetrics: function () {\n            var options = this.options;\n\n            this.adjustPadding();\n\n            this.adjustTitlePadding();\n\n            options.chart.width = options.chart.width || this.calculateWidth();\n            options.chart.height = options.chart.height || this.calculateHeight();\n\n            this.options = _.merge(options, {\n                chart: {\n                    plotWidth: options.chart.width - options.chart.margin.left - options.chart.margin.right - options.chart.internalPadding.left - options.chart.padding.right,\n                    plotHeight: options.chart.height - options.chart.margin.top - options.chart.margin.bottom - options.chart.padding.top - options.chart.internalPadding.bottom,\n                    plotLeft: options.chart.margin.left + options.chart.internalPadding.left,\n                    plotTop: options.chart.margin.top + options.chart.padding.top\n                }\n            });\n\n            if (this.options.chart.plotWidth <= 0 || this.options.chart.plotHeight <= 0) {\n                console.warn('The chart has no space to render. Either the width/height is zero or you have too much padding\\nWidth: ' + options.chart.width +\n                    '\\nHeight: ' + options.chart.height +\n                    '\\npadding-left: ' + options.chart.padding.left +\n                    '\\npadding-right: ' + options.chart.padding.right +\n                    '\\npadding-top: ' + options.chart.padding.top +\n                    '\\npadding-bottom: ' + options.chart.padding.bottom);\n\n                this.options.chart.plotWidth = this.options.chart.plotWidth < 0 ? 0 : this.options.chart.plotWidth;\n                this.options.chart.plotHeight = this.options.chart.plotHeight < 0 ? 0 : this.options.chart.plotHeight;\n            }\n        },\n\n        adjustPadding: function () {\n            // overriden by components that need to adjust padding\n            return this;\n        },\n\n        adjustTitlePadding: function () {\n            // overriden by components that need to adjust padding\n            return this;\n        },\n\n        composeOptions: function () {\n            var allDefaults = _.merge({}, defaults);\n            var mergeExtraOptions = function (opt) { _.merge(allDefaults, opt); };\n            var mergeDefaults = function (vis) { _.merge(allDefaults, vis.renderer.defaults); };\n\n            _.each(this._extraOptions, mergeExtraOptions);\n            _.each(this._visualizations, mergeDefaults);\n\n            // compose the final list of options right before start rendering\n            this.options = _.merge(this.options, _.merge({}, allDefaults, this.options));\n        },\n\n        baseRender: function () {\n            this.plotArea();\n\n            return this;\n        },\n\n        /**\n        * Renders this Contour instance and all its visualizations into the DOM.\n        *\n        * ### Example:\n        *\n        *     new Contour({ el:'.myChart' })\n        *           .pie([1,2,3])\n        *           .render();\n        *\n        * @function render\n        *\n        */\n        render: function () {\n            this.composeOptions();\n\n            this.calcMetrics();\n\n            this.baseRender();\n\n            this.renderVisualizations();\n\n            return this;\n        },\n\n        /**\n        * Clears this Contour instance and all its visualizations of any size information, so that on the next call to `render()` the instance is re-measured.\n        *\n        * The function takes two optional arguments `width` and `height`. If given a specific width/height the chart uses that sizing information on the next render.\n        *\n        * ### Example:\n        *\n        *     var contour = new Contour({ el:'.myChart' })\n        *           .pie([1,2,3])\n        *           .render();\n        *\n        *     var onResize = function(e) {\n        *          contour.resize().render();\n        *     }\n        *\n        *     window.addEventListener('resize', onResize);\n        *\n        * @function resize\n        * @param {Number} width (optional) The new width for the visualizations. If left blank, the width will be calcuated from options.el's parent.\n        * @param {Number} height (optional) The new height for the visualizations. If left blank, the height will be calcuated from options.el's parent.\n        */\n        resize: function(width, height) {\n\n            if (this.container)\n                this.container.style('height', 0);\n\n            delete this.options.chart.width;\n            delete this.options.chart.height;\n            delete this.options.chart.plotWidth;\n            delete this.options.chart.plotHeight;\n            delete this.options.chart.plotLeft;\n            delete this.options.chart.plotTop;\n\n            if (width)\n                this.options.chart.width = width;\n\n            if (height)\n                this.options.chart.height = height;\n            return this;\n        },\n\n        update: function () {\n            this.calcMetrics();\n            return this;\n        },\n\n        plotArea: function () {\n\n            var chartOpt = this.options.chart;\n\n            this.container = d3.select(this.options.el);\n            // fix a flicker im web-kit when animating opacity and the chart is in an iframe\n            this.container.attr('style', '-webkit-backface-visibility: hidden; position: relative');\n\n            if(!this.svg) {\n                this.svg = this.container\n                    .append('svg')\n                    .attr('viewBox', '0 0 ' + chartOpt.width + ' ' + chartOpt.height)\n                    .attr('preserveAspectRatio', 'xMinYMin')\n                    .attr('class', 'contour-chart')\n                    .attr('height', chartOpt.height)\n                    .append('g')\n                        .attr('transform', 'translate(' + chartOpt.margin.left + ',' + chartOpt.margin.top + ')');\n            } else {\n                this.svg\n                    .attr('transform', 'translate(' + chartOpt.margin.left + ',' + chartOpt.margin.top + ')');\n\n                d3.select(this.svg.node().parentNode)\n                    .attr('viewBox', '0 0 ' + chartOpt.width + ' ' + chartOpt.height)\n                    .attr('height', chartOpt.height);\n            }\n\n            return this;\n        },\n\n        createVisualizationLayer: function (vis, id) {\n            return this.svg.append('g')\n                .attr('vis-id', id)\n                .attr('vis-type', vis.type);\n        },\n\n        renderVisualizations: function () {\n\n            _.each(this._visualizations, function (visualization, index) {\n                var id = index + 1;\n                var layer = visualization.layer || this.createVisualizationLayer(visualization, id);\n                var opt = _.merge({}, this.options, visualization.options);\n\n                layer.attr('transform', 'translate(' + this.options.chart.internalPadding.left + ',' + (this.options.chart.padding.top || 0) + ')');\n\n                visualization.layer = layer;\n                visualization.parent = this;\n                visualization.render(layer, opt, this);\n            }.bind(this));\n\n            return this;\n        },\n\n        /**\n        * Assert that all the dependencies are in the Contour instance.\n        * For example, if a visualization requires Cartesian to be included in the instance,\n        * it could call this.checkDependencies('Cartesian'), and the framework would\n        * give a helpful error message if Cartesian was not included.\n        *\n        * @function checkDependencies\n        * @param {string|array} list of dependencies (as specified in the instance constructor)\n        *\n        */\n        checkDependencies: function (listOfDependencies) {\n            listOfDependencies = _.isArray(listOfDependencies) ? listOfDependencies : [listOfDependencies];\n            var _this = this;\n            var missing = [];\n\n            _.each(listOfDependencies, function (dep) {\n                if (_this._exposed.indexOf(dep) === -1) {\n                    missing.push(dep);\n                }\n            });\n\n            if (missing.length) {\n                throw new Error('ERROR: Missing depeendencies in the Contour instance (ej. new Contour({}).cartesian())\\n The missing dependencies are: [' + missing.join(', ') + ']\\nGo to http://forio.com/contour/documentation.html#key_concepts for more information');\n            }\n        },\n\n        ensureDefaults: function (options, renderer) {\n            if (_.isString(renderer)) {\n                renderer = this[renderer].renderer;\n            }\n\n            if (renderer.defaults) {\n                var defaults = renderer.defaults;\n                options = _.defaults(options || {}, defaults);\n                this.options = _.defaults(this.options, defaults);\n            }\n        },\n\n        /**\n        * Sets the same data into all visualizations for a Contour instance. Useful for creating interactive\n        * visualizations: call after getting the additional data from the user.\n        *\n        * ###Example:\n        *\n        *     var data = [1,2,3,4,5];\n        *     var chart = new Contour({ el:'.myChart' })\n        *           .cartesian()\n        *           .scatter(data)\n        *           .trendLine(data);\n        *\n        *     data.push(10);\n        *     chart.setData(data)\n        *           .render();\n        *\n        * @function setData\n        *\n        */\n        setData: function (data) {\n            _.invokeMap(this._visualizations, 'setData', data);\n\n            return this;\n        },\n\n        /**\n        * Returns a VisualizationContainer object for the visualization at a given index (0-based).\n        *\n        * ###Example:\n        *\n        *     var chart = new Contour({ el:'.myChart' })\n        *           .pie([1,2,3])\n        *           .render();\n        *\n        *     var myPie = chart.select(0);\n        *\n        *     // do something with the visualization, for example updating its data set\n        *     myPie.setData([6,7,8,9]).render();\n        *\n        * @function select\n        *\n        */\n        select: function (index) {\n            return this._visualizations[index];\n        },\n\n        // place holder function for now\n        data: function () {\n\n        },\n\n        dataNormalizer: _.nw.normalizeSeries,\n\n        isSupportedDataFormat: _.nw.isSupportedDataFormat\n    });\n\n    // exports for commonJS and requireJS styles\n    if (typeof module === 'object' && module && typeof module.exports === 'object') {\n        module.exports = Contour;\n    } else {\n        root.Contour = Contour;\n        if (typeof define === 'function' && define.amd) {\n            define('contour', [], function () { return Contour; });\n        }\n    }\n\n})();\n","(function () {\n\n    var YAxis = function (data, options, domain) {\n        this.data = data;\n        this.options = options;\n        this.domain = domain;\n    };\n\n    function setRange(scale, options) {\n        var rangeSize = options.chart.rotatedFrame ? options.chart.plotWidth : options.chart.plotHeight;\n        var range = options.chart.rotatedFrame ? [0, rangeSize] : [rangeSize, 0];\n        return scale.range(range);\n    }\n\n    YAxis.prototype = {\n        axis: function () {\n            /*jshint eqnull:true */\n            var options = this.options.yAxis;\n            var domain = this.domain;\n            var zeroAnchor = (options.zeroAnchor != undefined) ? options.zeroAnchor : options.scaling.options.zeroAnchor;\n            var tickValues = options.tickValues || _.nw.niceTicks(options.min, options.max, options.ticks, zeroAnchor, domain);\n            var numTicks = this.numTicks(domain, options.min, options.max);\n            var format = options.labels.formatter || d3.format(options.labels.format);\n\n            return d3.svg.axis()\n                .scale(this._scale)\n                .tickFormat(format)\n                .tickSize(options.innerTickSize, options.outerTickSize)\n                .tickPadding(options.tickPadding)\n                .ticks(numTicks)\n                .tickValues(tickValues);\n        },\n\n        scale: function (domain) {\n            if(!this._scale) {\n                this._scale = d3.scale.linear();\n                this.setDomain(domain);\n            }\n\n            setRange(this._scale, this.options);\n            return this._scale;\n        },\n\n        setDomain: function (domain) {\n            this._scale.domain(domain);\n            this._niceTheScale();\n            return this._scale;\n        },\n\n        update: function (domain, dataSrc) {\n            this.data = dataSrc;\n            this.setDomain(domain);\n            this.scale();\n        },\n\n        /*jshint eqnull:true*/\n        numTicks: function () {\n            return this.options.yAxis.ticks != null ? this.options.yAxis.ticks : undefined;\n        },\n\n        _niceTheScale: function () {\n            // nothing to do for the regular y-axis\n        }\n    };\n\n    _.nw.addAxis('YAxis', YAxis);\n\n})();\n","(function () {\n    /*jshint eqnull:true */\n    var defaults = {\n        chart: {\n            gridlines: 'none',\n            padding: {\n                top: 6,\n                right: 5,\n                // this get's defined based on the axis & title\n                bottom: undefined,\n                // this get's defined based on the axis & title\n                left: undefined\n            }\n        },\n\n        xAxis: {\n            // type of axis {ordinal|linear|time}\n            type: null, // default is linear in line.js (needs to be null here so overrides work)\n            categories: undefined,\n            max: undefined,\n            min: undefined,\n            innerTickSize: 6,\n            outerTickSize: 0,\n            tickPadding: 6,\n            maxTicks: undefined,\n            ticks: undefined,\n            tickValues: undefined,\n            title: undefined,\n            titlePadding: 4,\n            // padding between ranges (ie. columns) expressed in percentage of rangeBand width\n            innerRangePadding: 0.1,\n            // padding between all ranges (ie. columns) and the axis (left & right) expressed in percentage of rangeBand width\n            outerRangePadding: 0.1,\n            firstAndLast: false,\n            orient: 'bottom',\n            labels: {\n                format: undefined,\n                formatter: undefined\n            },\n            linearDomain: false,     // specify if a time domain should be treated linearly or ....\n        },\n\n        yAxis: {\n            // @param: {linear|smart|log}\n            // type: 'smart',\n            min: undefined,\n            max: undefined,\n            scaling: {\n                type: 'auto', // || 'smart' || 'centered'\n                options: {\n                    zeroAnchor: true\n                }\n            },\n            innerTickSize: 6,\n            outerTickSize: 6,\n            tickPadding: 4,\n            tickValues: undefined,\n            ticks: undefined,\n            title: undefined,\n            titlePadding: 4,\n            orient: 'left',\n            labels: {\n                // top, middle, bottom\n                verticalAlign: 'middle',\n                format: 's', // d3 formats\n                formatter: undefined // a function that formats each value ie. function (datum) { return 'x: ' + datum.x + ', y:' + datum.y }\n            }\n        }\n    };\n\n\n    /**\n    * Provides a Cartesian frame to the Contour instance.\n    *\n    * This is required for all visualizations displayed in a Cartesian frame, for example line charts, bar charts, area charts, etc. It is not required otherwise; for instance, pie charts do not use a Cartesian frame.\n    *\n    * ###Example:\n    *\n    *     new Contour(options)\n    *           .cartesian();\n    *\n    * @name cartesian\n    */\n    var cartesian = function () {\n        var maxTickSize = function (options) { return Math.max(options.outerTickSize || 0, options.innerTickSize || 0); };\n        return {\n            dataSrc: [],\n\n            init: function (options) {\n\n                // readonly properties (ie. user cannot modify)\n                var readOnlyProps = {\n                    chart: {\n                        rotatedFrame: false,\n                        internalPadding: {\n                            bottom: undefined,\n                            left: undefined\n                        }\n                    }\n                };\n\n                this.options = options || {};\n\n                _.merge(this.options, readOnlyProps);\n\n                var extraPadding = {};\n                if (!this.options.xAxis || !this.options.xAxis.firstAndLast) {\n                    extraPadding = { chart : { padding: { right: 15 }}};\n                }\n\n                this._extraOptions.push(_.merge({}, defaults, extraPadding));\n\n                return this;\n            },\n\n            xDomain: [],\n            yDomain: [],\n\n            _getYScaledDomain: function (domain, options) {\n                var opts = this.options.yAxis;\n                var zeroAnchor = (opts.zeroAnchor != undefined) ? opts.zeroAnchor : opts.scaling.options.zeroAnchor;\n                var absMin = zeroAnchor && domain && domain[0] > 0 ? 0 : undefined;\n                var min = opts.min != null ? opts.min : absMin;\n\n                if (opts.tickValues) {\n                    if (opts.min != null && opts.max != null) {\n                        return [opts.min, opts.max];\n                    } else if (opts.min != null) {\n                        return [opts.min, d3.max(zeroAnchor ? [0].concat(opts.tickValues) : opts.tickValues)];\n                    } else if (opts.max != null) {\n                        return [d3.min(zeroAnchor ? [0].concat(opts.tickValues) : opts.tickValues), opts.max];\n                    } else {\n                        return d3.extent(zeroAnchor || opts.min != null ? [min].concat(opts.tickValues) : opts.tickValues);\n                    }\n                } else if (opts.smartAxis || opts.scaling.type === 'smart') {\n                    return d3.extent(zeroAnchor || opts.min != null ? [min].concat(domain) : domain);\n                } else if (opts.scaling.type === 'centered') {\n                    return d3.extent(domain);\n                }\n\n                return _.nw.extractScaleDomain(domain, min, opts.max, opts.ticks);\n            },\n\n            /*jshint eqnull:true */\n            adjustPadding: function () {\n                var xOptions = this.options.xAxis;\n                var yOptions = this.options.yAxis;\n                // bottom padding calculations\n                if (this.options.chart.padding.bottom == null) {\n                    this.options.chart.internalPadding.bottom = this._getAdjustedBottomPadding(xOptions);\n                } else {\n                    this.options.chart.internalPadding.bottom = this.options.chart.padding.bottom || 0;\n                }\n\n                this.options.chart.padding.top = this.options.chart.internalPadding.top = this._getAdjustedTopPadding(xOptions);\n\n                // left padding calculations\n                if (this.options.chart.padding.left == null) {\n                    this.options.chart.internalPadding.left = this._getAdjustedLeftPadding(yOptions);\n                } else {\n                    this.options.chart.internalPadding.left = this.options.chart.padding.left;\n                }\n\n                this.options.chart.padding.right = this.options.chart.internalPadding.right = this._getAdjustedRightPadding(yOptions);\n            },\n\n            _getAdjustedTopPadding: function (options) {\n                return this.options.chart.padding.top;\n            },\n\n            _getAdjustedBottomPadding: function (options) {\n                if (options.ticks !== 0) {\n                    var xLabels = this.xDomain;\n                    var xAxisText = xLabels.join('<br>');\n                    var xLabelBounds = _.nw.textBounds(xAxisText, '.x.axis');\n                    var regularXBounds = _.nw.textBounds('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890', '.x.axis');\n                    var em = regularXBounds.height;\n                    var ang = options.labels && options.labels.rotation ? options.labels.rotation % 360 : 0;\n                    var xLabelHeightUsed = ang === 0 ? regularXBounds.height : Math.ceil(Math.abs(xLabelBounds.width * Math.sin(_.nw.degToRad(ang))) + em / 5) ;\n                    return maxTickSize(options) + (options.tickPadding || 0) +\n                        xLabelHeightUsed;\n                } else {\n                    return maxTickSize(options) + (options.tickPadding || 0);\n                }\n            },\n\n            _getAdjustedLeftPadding: function (options) {\n                var yDomainScaled = this._getYScaledDomain(this.yDomain, this.options);\n                var tmpScale = d3.scale.linear().domain(yDomainScaled);\n                var yLabels = tmpScale.ticks(options.ticks);\n\n                var format = options.labels.formatter || d3.format(options.labels.format || ',.0f');\n                var yAxisText = _.map(yLabels, format).join('<br>');\n                var yLabelBounds = _.nw.textBounds(yAxisText, '.y.axis');\n                return maxTickSize(this.options.yAxis) + (this.options.yAxis.tickPadding || 0) +\n                    yLabelBounds.width;\n            },\n\n            _getAdjustedRightPadding: function (options) {\n                return this.options.chart.padding.right;\n            },\n\n            adjustTitlePadding: function () {\n                var titleBounds;\n                if (this.options.xAxis.title || this.options.yAxis.title) {\n                    if(this.options.xAxis.title) {\n                        titleBounds = _.nw.textBounds(this.options.xAxis.title, '.x.axis-title');\n                        this.options.chart.internalPadding.bottom += titleBounds.height + this.options.xAxis.titlePadding;\n                    }\n\n                    if(this.options.yAxis.title) {\n                        titleBounds = _.nw.textBounds(this.options.yAxis.title, '.y.axis-title');\n                        this.options.chart.internalPadding.left += titleBounds.height + this.options.yAxis.titlePadding;\n                    }\n                }\n            },\n\n            computeXScale: function () {\n                if (!this.xDomain) throw new Error('You are trying to render without setting data (xDomain).');\n\n                if(!this.xScale) {\n                    this.xScaleGenerator = _.nw.xScaleFactory(this.dataSrc, this.options);\n                    this.xScale = this.xScaleGenerator.scale(this.xDomain);\n                    this.rangeBand = this.xScaleGenerator.rangeBand();\n                } else {\n                    this.xScaleGenerator.update(this.xDomain, this.dataSrc);\n                    this.rangeBand = this.xScaleGenerator.rangeBand();\n                }\n            },\n\n            computeYScale: function () {\n                if (!this.yDomain) throw new Error('You are trying to render without setting data (yDomain).');\n\n                var yScaleDomain = this._getYScaledDomain(this.yDomain, this.options);\n\n                if(!this.yScale) {\n                    this.yScaleGenerator = _.nw.yScaleFactory(this.dataSrc, this.options, this.options.yAxis.type, this.yDomain);\n                    this.yScale = this.yScaleGenerator.scale(yScaleDomain);\n                } else {\n                    this.yScaleGenerator.update(yScaleDomain, this.dataSrc);\n                }\n            },\n\n            /**\n            * Provides a scaling function based on the xAxis values.\n            *\n            * ###Example:\n            *\n            *     var scaledValue = this.xScale(100);\n            *\n            * @function xScale\n            * @param {Number|String} value The value to be scaled.\n            * @return {Number} The scaled value according to the current xAxis settings.\n            */\n            xScale: undefined,\n\n            /**\n            * Provides a scaling function based on the yAxis values.\n            *\n            * ###Example:\n            *\n            *     var scaledValue = this.yScale(100);\n            *\n            * @function yScale\n            * @param {Number} value The value to be scaled.\n            * @return {Number} The scaled value according to the current yAxis settings.\n            */\n            yScale: undefined,\n\n            /**\n            * Modifies the domain for the yAxis.\n            *\n            * ###Example:\n            *\n            *     this.setYDomain([100, 200]);\n            *\n            * @function setYDomain\n            * @param {Array} domain The domain array representing the min and max values visible on the yAxis.       */\n            setYDomain: function (domain) {\n                this.yScaleGenerator.setDomain(domain);\n            },\n\n            /**\n            * Redraws the yAxis with the new settings and domain.\n            *\n            * ###Example:\n            *\n            *     this.redrawYAxis();\n            *\n            * @function redrawYAxis\n            */\n            redrawYAxis: function () {\n                this.svg.select('.y.axis').call(this.yAxis());\n                this.renderGridlines();\n            },\n\n            _animationDuration: function () {\n                var opt = this.options.chart.animations;\n                return opt && opt.enable ?\n                    opt.duration != null ? opt.duration : 400 :\n                    0;\n            },\n\n            computeScales: function () {\n                this.computeXScale();\n                this.computeYScale();\n\n                return this;\n            },\n\n            _xAxis: undefined,\n            xAxis: function () {\n                if (!this._xAxis) {\n                    this._xAxis = this.xScaleGenerator.axis().orient(this.options.xAxis.orient);\n                }\n                return this._xAxis;\n            },\n\n            _yAxis: undefined,\n            yAxis: function () {\n                if(!this._yAxis) {\n                    this._yAxis = this.yScaleGenerator.axis().orient(this.options.yAxis.orient);\n                }\n                return this._yAxis;\n            },\n\n            renderXAxis: function () {\n                var xAxis = this.xAxis();\n                var y = this.options.chart.plotHeight + this.options.chart.padding.top;\n                var x = this.options.chart.internalPadding.left;\n\n                this._xAxisGroup = this.svg.selectAll('.x.axis')\n                    .data([1]);\n\n                if (!this._xAxisGroup.node()) {\n                    this._xAxisGroup.enter()\n                        .append('g')\n                        .attr('transform', 'translate(' + x + ',' + y + ')')\n                        .attr('class', 'x axis');\n                } else {\n                    d3.select(this._xAxisGroup.node())\n                        .attr('transform', 'translate(' + x + ',' + y + ')');\n                }\n\n\n                this._xAxisGroup\n                    .transition().duration(this._animationDuration())\n                    .call(xAxis);\n\n                this.xScaleGenerator.postProcessAxis(this._xAxisGroup);\n\n                return this;\n            },\n\n            renderYAxis: function () {\n                var x = this.options.chart.internalPadding.left;\n                var y = this.options.chart.padding.top;\n\n                this._yAxisGroup = this.svg.selectAll('.y.axis')\n                    .data([1]);\n\n                if (!this._yAxisGroup.node()) {\n                    this._yAxisGroup\n                        .enter().append('g')\n                        .attr('transform', 'translate(' + x + ',' + y + ')')\n                        .attr('class', 'y axis');\n                } else {\n                    d3.select(this._yAxisGroup.node())\n                        .attr('transform', 'translate(' + x + ',' + y + ')');\n                }\n\n                this._renderYAxisElement();\n\n                return this;\n            },\n\n            _renderYAxisElement: function () {\n                var options = this.options.yAxis;\n                var alignmentOffset = { bottom: '.8em', middle: '.35em', top: '0' };\n\n                this._yAxisGroup\n                    .transition().duration(this._animationDuration())\n                    .call(this.yAxis())\n                    .selectAll('.tick text')\n                        .attr('dy', alignmentOffset[options.labels.verticalAlign]);\n            },\n\n            renderAxisLabels: function () {\n                var adjustFactor = 40/46.609; // this factor is to account for the difference between the actual svg size and what we get from the DOM\n                var bounds, x, y;\n                var el;\n\n                if (this.options.xAxis.title) {\n                    bounds = _.nw.textBounds(this.options.xAxis.title, '.x.axis-title');\n                    y = this.options.chart.internalPadding.bottom;\n                    x = 0;\n                    el = this._xAxisGroup.selectAll('.x.axis-title').data([1]);\n                    if (!el.node()) {\n                        el.enter().append('text')\n                            .attr('class', 'x axis-title');\n                    }\n\n                    d3.select(el.node())\n                        .attr('x', x)\n                        .attr('y', y)\n                        .attr('alignment-baseline', 'after-edge')\n                        .attr('dx', (this.options.chart.plotWidth - bounds.width) / 2)\n                        .text(this.options.xAxis.title);\n                }\n\n                if (this.options.yAxis.title) {\n                    bounds = _.nw.textBounds(this.options.yAxis.title, '.y.axis-title');\n                    y = -this.options.chart.internalPadding.left + bounds.height * adjustFactor;\n                    x = 0;\n                    el = this._yAxisGroup.selectAll('.y.axis-title').data([1]);\n                    if (!el.node()) {\n                        el.enter().append('text')\n                            .attr('class', 'y axis-title');\n                    }\n\n                    d3.select(el.node())\n                        .attr('class', 'y axis-title')\n                        .attr('transform', 'rotate(-90)')\n                        .attr('x', x)\n                        .attr('y', y)\n                        .attr('dx', -(this.options.chart.plotHeight + bounds.width) / 2)\n                        .attr('dy', 0)\n                        .text(this.options.yAxis.title);\n                }\n\n                return this;\n            },\n\n            renderGridlines: function () {\n                var option = this.options.chart.gridlines;\n                var horizontal = option === 'horizontal' || option === 'both';\n                var vertical = option === 'vertical' || option === 'both';\n\n                function getYTicks(axis, smart) {\n                    var tickValues = axis.tickValues();\n\n                    if(!tickValues) {\n                        var numTicks = axis.ticks()[0];\n                        return axis.scale().ticks(numTicks).slice(1);\n                    }\n\n                    if (smart) {\n                        tickValues.pop();\n                    }\n\n                    return tickValues.slice(1);\n                }\n\n                function getXTicks(axis) {\n                    return axis.tickValues() || (axis.scale().ticks ? axis.scale().ticks().slice(1) : axis.scale().domain());\n                }\n\n                var ticks, gr;\n                var x = this.xScale;\n                var y = this.yScale;\n\n                if(horizontal) {\n                    var smartAxis = this.options.yAxis.smartAxis || this.options.yAxis.scaling.type === 'smart'\n                    ticks = getYTicks(this.yAxis(), smartAxis);\n                    var w = this.options.chart.plotWidth;\n\n                    // remove previous lines (TODO: we need a better way)\n                    // this._yAxisGroup.select('g.grid-lines').remove();\n                    gr = this._yAxisGroup\n                        .selectAll('.grid-lines')\n                        .data([ticks]);\n\n                    gr.enter().append('svg:g')\n                        .attr('class', 'grid-lines');\n\n                    var lines = gr.selectAll('.grid-line')\n                        .data(function (d) { return d; });\n\n                    lines.transition().duration(this._animationDuration())\n                        .attr('x1', 0)\n                        .attr('x2', function () {\n                            return w;\n                        })\n                        .attr('y1', y)\n                        .attr('y2', y);\n\n                    lines.enter().append('line')\n                            .attr('class', 'grid-line')\n                            .attr('x1', 0)\n                            .attr('x2', function () {\n                                return w;\n                            })\n                            .attr('y1', y)\n                            .attr('y2', y);\n\n                    lines.exit().remove();\n                }\n\n                if(vertical) {\n                    // remove previous lines (TODO: we need a better way)\n                    this._xAxisGroup.select('g.grid-lines').remove();\n                    gr = this._xAxisGroup.append('svg:g').attr('class', 'grid-lines');\n                    ticks = getXTicks(this.xAxis());\n                    var offset = this.rangeBand / 2;\n                    var h = this.options.chart.plotHeight;\n\n                    gr.selectAll('.grid-line')\n                        .data(ticks)\n                        .enter().append('line')\n                            .attr('class', 'grid-line')\n                            .attr('x1', function (d) { return x(d) + offset; })\n                            .attr('x2', function (d) { return x(d) + offset; })\n                            .attr('y1', -h)\n                            .attr('y2', 0);\n                }\n\n                return this;\n            },\n\n            renderBackground: function () {\n                var options = this.options.chart;\n                this.background = this.background || this.createVisualizationLayer('background', 0);\n                var g = this.background.selectAll('.plot-area-background').data([null]);\n\n                g.enter().append('rect')\n                    .attr('class', 'plot-area-background')\n                    .attr('x', options.internalPadding.left)\n                    .attr('y', options.internalPadding.top)\n                    .attr('width', options.plotWidth)\n                    .attr('height', options.plotHeight);\n\n                g.exit().remove();\n\n                return this;\n            },\n\n            render: function () {\n\n                this.composeOptions();\n                this.adjustDomain();\n                this.calcMetrics();\n                this.computeScales();\n                this.baseRender();\n\n                this\n                    .renderBackground()\n                    .renderXAxis()\n                    .renderYAxis()\n                    .renderGridlines()\n                    .renderAxisLabels()\n                    .renderVisualizations();\n\n                return this;\n            },\n\n            datum: function (d, index) {\n                if(_.isObject(d) && _.isArray(d.data))\n                    return _.map(d.data, _.bind(this.datum, this));\n\n                return {\n                    y: _.isObject(d) ? d.y : d,\n                    x: _.isObject(d) ? d.x : this.options.xAxis.categories ? this.options.xAxis.categories[index] : index\n                };\n            },\n\n            adjustDomain: function () {\n                var extents = this.getExtents();\n                this._adjustXDomain(extents);\n                this._adjustYDomain(extents);\n\n                this._yAxis = null;\n                this._xAxis = null;\n                this.yScale = null;\n            },\n\n            _adjustXDomain: function (extents) {\n                this.xDomain = this.getXDomain();\n                var dataVis = _.filter(this._visualizations, function (v) { return _.nw.isSupportedDataFormat(v.data); });\n                this.dataSrc = _.flatten(\n                    _.map(dataVis, function (v) {\n                        return _.flatten(_.map(v.data, _.bind(this.datum, this)));\n                    }.bind(this))\n                );\n\n                // _.every() on empty array returns true, so we guard against it\n                var isCategoricalData = this.dataSrc.length && _.every(this.dataSrc, function (d) { return +d.x !== d.x; });\n                var dataSrcCategories = _.uniq(_.map(this.dataSrc, 'x'));\n                var sameCats = this.options.xAxis.categories ?\n                    this.options.xAxis.categories.length === dataSrcCategories.length && _.intersection(this.options.xAxis.categories, dataSrcCategories).length === dataSrcCategories.length :\n                    false;\n\n                if (isCategoricalData && !(this.options.xAxis.categories && sameCats)) {\n                    this.options.xAxis.categories = dataSrcCategories;\n                }\n            },\n\n            _adjustYDomain: function (extents) {\n                this.yDomain = extents.length ? extents : [0, 10];\n                this.yMin = this.yDomain[0];\n                this.yMax = this.yDomain[this.yDomain.length - 1];\n            },\n\n            getExtents: function (axis) {\n                var field = axis && axis === 'x' ? 'xExtent' : 'yExtent';\n                var dataVis = _.filter(this._visualizations, function (v) { return _.nw.isSupportedDataFormat(v.data); });\n                var all = _.flatten(_.map(dataVis, field));\n                return all.length ? d3.extent(all) : [];\n            },\n\n            getXDomain: function () {\n                var dataVis = _.filter(this._visualizations, function (v) { return _.nw.isSupportedDataFormat(v.data); });\n                var all = _.nw.uniq(_.flatten(_.map(dataVis, 'xDomain')));\n\n                return all;\n            }\n\n        };\n    };\n\n    Contour.expose('cartesian', cartesian);\n\n})();\n","(function () {\n\n    var root = this;\n\n    var defaultParams = {\n        type: 'image/png', // the mime type of the image; see http://en.wikipedia.org/wiki/Comparison_of_web_browsers#Image_format_support for browser support\n        fileName: 'contour.png', // the fileName for the `download()`\n        target: undefined, // a selector for the container in which to `place()` the image; for example '#image'\n        backgroundColor: '#fff', // the fill color of the image, or `null` for transparent background\n        width: undefined, // the width of the exported image; if `height` is falsy then the height will be scaled proportionally\n        height: undefined // the height of the exported image; if `width` is falsy then the width will be scaled proportionally\n    };\n\n    // browser capabilities\n    var browser = {\n        checked: false // true after browser capabilities have been checked\n    };\n\n    // queue of operations to perform synchronously\n    var queue = [];\n    // true if working on something\n    var working = false;\n\n\n    /**\n    * Saves a visualization as an image.\n    * You can either trigger a download of the image or place the image within a container.\n    *\n    * ###Example:\n    *\n    *     var chart = new Contour(...)\n    *         ...\n    *         .exportable()\n    *         .render();\n    *\n    *     document.getElementById('save').onclick = function () {\n    *         chart.download({\n    *             fileName: 'myContourChart.png'\n    *         });\n    *\n    * ###External dependencies:\n    *\n    * IE9-11 and Safari won't safely export a canvas to which an SVG has been\n    * rendered. To get around this limitation in those browsers, we use CanVG\n    * (\"canned veggies\"), an implementation of SVG written in JavaScript to\n    * render the SVG directly to the canvas. During initialization of the\n    * 'exportable' plugin, CanVG is automatically downloaded from\n    * http://canvg.googlecode.com/svn/trunk/ if the browser fails the test\n    * SVG export.\n    *\n    * @name exportable\n    */\n    var exportable = function () {\n        // CSS properties to ignore for diff\n        var cssIgnoreDiff = {\n            cssText: 1,\n            parentRule: 1\n        };\n        // CSS properties shared between HTML and SVG\n        var cssSharedSvg = {\n            font: 1,\n            fontFamily: 1,\n            fontSize: 1,\n            fontSizeAdjust: 1,\n            fontStretch: 1,\n            fontStyle: 1,\n            fontVariant: 1,\n            fontWeight: 1,\n            direction: 1,\n            letterSpacing: 1,\n            textDecoration: 1,\n            unicodeBidi: 1,\n            wordSpacing: 1,\n            clip: 1,\n            cursor: 1,\n            display: 1,\n            overflow: 1,\n            visibility: 1,\n            opacity: 1\n        };\n\n\n        // interface\n\n        return {\n            init: function () {\n                // check browser capabilities and set up necessary shims\n                // only do this once per page load\n                if (!browser.checked) {\n                    addToQueue(checkBrowser);\n                }\n\n                return this;\n            },\n\n            /**\n            * Saves a visualization as an image, triggering a download.\n            *\n            * ###Browser variations:\n            *\n            * - Chrome saves the image.\n            * - Firefox and IE10-11 display a prompt, then save the image.\n            * - IE9 and Safari open the image in a new tab, enabling the user to manually save the image.\n            *\n            * ###Example:\n            *\n            *     var chart = new Contour(...)\n            *         ...\n            *         .exportable()\n            *         .render();\n            *\n            *     document.getElementById('save').onclick = function () {\n            *         chart.download({\n            *             fileName: 'contour.png',\n            *             width: 640\n            *         });\n            *\n            * @name download\n            * @param {object} options Configuration options specific to downloading the image.\n            * @param {string} options.type Specifies the mime type of the image. See http://en.wikipedia.org/wiki/Comparison_of_web_browsers#Image_format_support for browser support. Default: 'image/png'.\n            * @param {string} options.fileName Specifies the file name for the download. Default: 'contour.png'.\n            * @param {string} options.backgroundColor Specifies the fill color of the image. Use `null` for transparent background. Default: '#fff'.\n            * @param {int} options.width Specifies the width of the exported image. If `height` is falsy then the height is scaled proportionally. Default: `undefined`, which means don't do any scaling.\n            * @param {int} options.height Specifies the height of the exported image. If `width` is falsy then the width is scaled proportionally. Default: `undefined`, which means don't do any scaling.\n            */\n            download: function (options) {\n                var container = this.container;\n\n                addToQueue(function () {\n                    exportImage(container, options, 'download');\n                });\n\n                return this;\n            },\n\n            /**\n            * Saves a visualization as an image, placing it within a container.\n            *\n            * ###Example:\n            *\n            *     var chart = new Contour(...)\n            *         ...\n            *         .exportable()\n            *         .render();\n            *     document.getElementById('save').onclick = function () {\n            *         chart.place({\n            *             target: '#image'\n            *         });\n            *\n            * @name place\n            * @param {object} options Configuration options specific to placing the image in a container.\n            * @param {string} options.type Specifies the mime type of the image. See http://en.wikipedia.org/wiki/Comparison_of_web_browsers#Image_format_support for browser support. Default: 'image/png'.\n            * @param {string} options.target Specifies a selector for the container. For example: '#image' will append the image into `<div id=\"image\"></div>`.\n            * @param {string} options.backgroundColor Specifies the fill color of the image. Use `null` for transparent background. Default: '#fff'.\n            * @param {int} options.width Specifies the width of the exported image. If `height` is falsy then the height is scaled proportionally. Default: `undefined`, which means don't do any scaling.\n            * @param {int} options.height specifies the height of the exported image. If `width` is falsy then the width is scaled proportionally. Default: `undefined`, which means don't do any scaling.\n            */\n            place: function (options) {\n                var container = this.container;\n\n                addToQueue(function () {\n                    exportImage(container, options, 'place');\n                });\n\n                return this;\n            }\n        };\n\n\n        // SVG to canvas export function\n        // adapted from https://github.com/sampumon/SVG.toDataURL\n        // which based on http://svgopen.org/2010/papers/62-From_SVG_to_Canvas_and_Back/#svg_to_canvas\n        function getSvgDataUrl(svg, options, dataUrlCreated) {\n            switch (options.type) {\n                case 'image/svg+xml':\n                    return makeSvgUrl();\n\n                default: // 'image/png' or 'image/jpeg'\n                    return makeImageUrl();\n            }\n\n\n            function encodeBase64DataUrl(svgXml) {\n                // https://developer.mozilla.org/en/DOM/window.btoa\n                return 'data:image/svg+xml;base64,' + btoa(svgXml);\n            }\n\n            // convert base64/URLEncoded data component to raw binary data held in a string\n            function dataUrlToBlob(dataUrl) {\n                /*jshint nonstandard:true*/\n                var byteString;\n                if (dataUrl.split(',')[0].indexOf('base64') >= 0) {\n                    byteString = atob(dataUrl.split(',')[1]);\n                } else {\n                    byteString = unescape(dataUrl.split(',')[1]);\n                }\n\n                // separate out the mime component\n                var mimeString = dataUrl.split(',')[0].split(':')[1].split(';')[0];\n\n                // write the bytes of the string to a typed array\n                var byteArray = new Uint8Array(byteString.length);\n                for (var i = 0; i < byteString.length; i++) {\n                    byteArray[i] = byteString.charCodeAt(i);\n                }\n\n                return new Blob([byteArray], {\n                    type: mimeString\n                });\n            }\n\n            function makeSvgUrl() {\n                var svgXml = (new XMLSerializer()).serializeToString(svg);\n                var svgDataUrl = encodeBase64DataUrl(svgXml);\n\n                dataUrlCreated(svgDataUrl, null, function () {});\n            }\n\n            function makeImageUrl() {\n                var canvas = document.createElement('canvas');\n                var context = canvas.getContext('2d');\n\n                var svgXml = (new XMLSerializer()).serializeToString(svg);\n\n                if (root.canvg) {\n                    // use Canvg renderer for image export\n                    renderImageCanvg();\n                } else {\n                    // use native renderer for image export (this might fail)\n                    renderImageNative();\n                }\n\n                function imageRendered() {\n                    var imageDataUrl = canvas.toDataURL(options.type);\n\n                    if (browser.createsObjectUrls) {\n                        var imageBlob = dataUrlToBlob(imageDataUrl);\n\n                        var domUrl = root.URL || root.webkitURL;\n                        var objectUrl = domUrl.createObjectURL(imageBlob);\n\n                        dataUrlCreated(objectUrl, imageBlob, function () {\n                            domUrl.revokeObjectURL(objectUrl);\n                        });\n                    } else {\n                        dataUrlCreated(imageDataUrl, null, function () {});\n                    }\n                }\n\n                function renderImageNative() {\n                    var svgImg = new Image();\n                    svgImg.src = encodeBase64DataUrl(svgXml);\n\n                    svgImg.onload = function () {\n                        canvas.width = svgImg.width;\n                        canvas.height = svgImg.height;\n\n                        if (options.backgroundColor) {\n                            context.fillStyle = options.backgroundColor;\n                            context.fillRect(0, 0, svgImg.width, svgImg.height);\n                        }\n\n                        context.drawImage(svgImg, 0, 0);\n\n                        imageRendered();\n                    };\n\n                    svgImg.onerror = function () {\n                        throw new Error('Cannot export image');\n                    };\n                }\n\n                function renderImageCanvg() {\n                    // note that Canvg gets the SVG element dimensions incorrectly if not specified as attributes\n                    // also this Canvg call is synchronous and blocks\n                    canvg(canvas, svgXml, {\n                        ignoreMouse: true,\n                        ignoreAnimation: true,\n                        offsetX: undefined,\n                        offsetY: undefined,\n                        scaleWidth: undefined,\n                        scaleHeight: undefined,\n                        renderCallback: imageRendered\n                    });\n                }\n            }\n        }\n\n\n        // clone SVG in isolation with styles directly applied\n        function createSvgClone(svgNode, svgCloned) {\n            createIsolatedNode(function (nodeClone, destroyIsolatedNode) {\n                // clone nodes and apply styles directly to each node\n                cloneNodes(svgNode, nodeClone);\n\n                // clone legend DIV as SVG\n                cloneLegendDiv(svgNode, nodeClone);\n\n                svgCloned(d3.select(nodeClone).select('svg').node(), destroyIsolatedNode);\n            });\n\n\n            // compare computed styles at this node and apply the differences directly\n            function applyStyles(sourceNode, targetNode) {\n                var sourceStyle = root.getComputedStyle(sourceNode);\n                var targetStyle = root.getComputedStyle(targetNode);\n\n                for (var prop in sourceStyle) {\n                    if (!cssIgnoreDiff[prop] && !isFinite(prop)) {\n                        // note that checking for sourceStyle.hasOwnProperty(prop) eliminates all valid style properties in Firefox\n                        if (targetStyle[prop] !== sourceStyle[prop]) {\n                            targetNode.style[prop] = sourceStyle[prop];\n                        }\n                    }\n                }\n            }\n\n            // clone nodes and apply styles directly to each node\n            function cloneNodes(sourceNode, targetNode) {\n                var newNode = sourceNode.cloneNode(false);\n                targetNode.appendChild(newNode);\n\n                if (!sourceNode.tagName) return; // skip inner text\n\n                // compare computed styles at this node and apply the differences directly\n                applyStyles(sourceNode, newNode);\n\n                _.each(sourceNode.childNodes, function (childNode) {\n                    // clone each child node and apply styles\n                    cloneNodes(childNode, newNode);\n                });\n            }\n\n            function createIsolatedNode(nodeLoaded) {\n                var iframe = document.body.appendChild(document.createElement('iframe'));\n                iframe.style.visibility = 'hidden';\n                var iframeWindow = iframe.contentWindow;\n                var iframeDocument = iframeWindow.document;\n\n                iframe.onload = function () {\n                    var nodeClone = iframeDocument.createElement('div');\n                    iframeDocument.body.appendChild(nodeClone);\n\n                    var destroyIframe = function () {\n                        // destroy clone\n                        iframeDocument.body.removeChild(nodeClone);\n                        document.body.removeChild(iframe);\n                    };\n\n                    nodeLoaded(nodeClone, destroyIframe);\n                };\n\n                iframeDocument.open();\n                iframeDocument.write('<!DOCTYPE html>');\n                iframeDocument.write('<html><head></head><body></body></html>');\n                iframeDocument.close();\n            }\n\n            function applyDivStylesToSvg(sourceNode, target) {\n                var targetNode = target.node();\n                var sourceStyle = root.getComputedStyle(sourceNode);\n                var targetStyle = root.getComputedStyle(targetNode);\n\n                for (var prop in sourceStyle) {\n                    if (cssSharedSvg[prop]) {\n                        // note that checking for sourceStyle.hasOwnProperty(prop) eliminates all valid style properties in Firefox\n                        if (targetStyle[prop] !== sourceStyle[prop]) {\n                            targetNode.style[prop] = sourceStyle[prop];\n                        }\n                    }\n                }\n\n                // translate DIV styles to SVG attributes and styles\n                switch (targetNode.nodeName) {\n                case 'rect':\n                    target.attr({\n                        'rx': sourceStyle.borderTopLeftRadius,\n                        'ry': sourceStyle.borderTopLeftRadius\n                    });\n                    target.style({\n                        'fill': sourceStyle.backgroundColor,\n                        'stroke': sourceStyle.borderLeftColor,\n                        'stroke-width': sourceStyle.borderLeftWidth\n                    });\n                    break;\n                case 'text':\n                    target.style({\n                        'fill': sourceStyle.color\n                    });\n                    break;\n                }\n            }\n\n            function cloneLegendDiv(sourceNode, targetNode) {\n                var containerDiv = d3.select(sourceNode.parentNode).select('div.contour-legend');\n                if (containerDiv.empty()) return;\n\n                var containerDivNode = containerDiv.node();\n\n                var containerSvg = d3.select(targetNode).select('svg').append('g')\n                    .attr('transform', 'translate(' + (containerDivNode.offsetLeft + containerDivNode.clientLeft) +\n                        ',' + (containerDivNode.offsetTop + containerDivNode.clientTop) + ')');\n                applyDivStylesToSvg(containerDivNode, containerSvg);\n\n                var rect = containerSvg.append('rect')\n                    .attr('width', containerDivNode.clientWidth)\n                    .attr('height', containerDivNode.clientHeight);\n                applyDivStylesToSvg(containerDivNode, rect);\n\n                var entriesDivs = containerDiv.selectAll('.contour-legend-entry');\n\n                _.each(entriesDivs[0], function (entryDivNode) {\n                    var entryDiv = d3.select(entryDivNode);\n\n                    var enter = containerSvg.append('g');\n                    applyDivStylesToSvg(entryDivNode, enter);\n\n                    var entryDivKeyNode = getEntryDivSubNode('.contour-legend-key');\n                    var swatch = enter.append('rect')\n                        .attr('x', entryDivKeyNode.offsetLeft)\n                        .attr('y', entryDivKeyNode.offsetTop)\n                        .attr('width', entryDivKeyNode.offsetWidth - 2)\n                        .attr('height', entryDivKeyNode.offsetHeight - 2);\n                    applyDivStylesToSvg(entryDivKeyNode, swatch);\n\n                    var entryDivSeriesNode = getEntryDivSubNode('.series-name');\n                    var text = enter.append('text')\n                        .attr('x', entryDivSeriesNode.offsetLeft + 1)\n                        .attr('y', entryDivSeriesNode.offsetTop + entryDivSeriesNode.offsetHeight - entryDivSeriesNode.offsetParent.clientTop - 2)\n                        .text(entryDivSeriesNode.textContent);\n                    applyDivStylesToSvg(entryDivSeriesNode, text);\n\n                    function getEntryDivSubNode(selector) {\n                        return entryDiv.select(selector).node();\n                    }\n                });\n            }\n        }\n\n\n        function getProportionedBounds(original, specified) {\n            if (specified.width && specified.height) {\n                return specified;\n            } else if (specified.width) {\n                return {\n                    width: specified.width,\n                    height: specified.width * original.height / original.width\n                };\n            } else if (specified.height) {\n                return {\n                    width: specified.height * original.width / original.height,\n                    height: specified.height\n                };\n            } else {\n                return original;\n            }\n        }\n\n\n        function exportImage(container, options, exporter) {\n            startWork();\n\n            // merge configuration options with defaults\n            options = options || {};\n            _.defaults(options, defaultParams);\n\n            var svgNode = container.select('svg').node();\n            // get bounds from original SVG, and proportion them based on specified options\n            var bounds = svgNode.getBoundingClientRect();\n            var boundsClone = getProportionedBounds(bounds, options);\n\n            // clone SVG in isolation with styles directly applied\n            createSvgClone(svgNode, performExport);\n\n            function performExport(svgNodeClone, destroySvgClone) {\n                svgNodeClone.setAttribute('width', boundsClone.width);\n                svgNodeClone.setAttribute('height', boundsClone.height);\n\n                // Safari can only open a new tab with the image\n                // the tab must be opened before `getSvgDataUrl()` to avoid getting blocked due to asynchronous callbacks\n                var win;\n                if (exporter === 'download' && !(browser.aDownloads || browser.savesMsBlobs)) {\n                    win = root.open();\n                }\n\n                getSvgDataUrl(svgNodeClone, options, function (url, blob, revokeUrl) {\n                    destroySvgClone();\n\n                    // exporter functions\n                    var exporters = {\n                        'download': function () {\n                            if (browser.aDownloads) {\n                                // make a link to download and click it\n                                var a = document.createElement('a');\n                                a.download = options.fileName;\n                                a.href = url;\n                                document.body.appendChild(a);\n                                a.click();\n                                document.body.removeChild(a);\n                            } else if (browser.savesMsBlobs && blob) {\n                                // IE10-11 support a method to save/open a blob\n                                navigator.msSaveOrOpenBlob(blob, options.fileName);\n                            } else {\n                                // Safari and IE9 can only open a new tab with the image\n                                if (!win) {\n                                    // in case `blob` was falsy or the `open()` above returned undefined, `win` will be undefined, so attempt here (and this might return undefined as well)\n                                    win = root.open();\n                                }\n                                if (win) {\n                                    if (browser.createsObjectUrls) {\n                                        // Safari can set the url of the newly-opened tab to the object URL of the blob\n                                        win.location = url;\n                                    } else {\n                                        // for IE9, create a document with the image\n                                        var doc = win.document;\n                                        doc.write('<!DOCTYPE html>');\n                                        doc.write('<html><head></head><body>');\n                                        doc.write('<img src=\"' + url + '\">');\n                                        doc.write('</body></html>');\n                                    }\n                                }\n                            }\n                            // wait for download to start\n                            setTimeout(function () {\n                                revokeUrl();\n                                finishWork();\n                            }, 1);\n                        },\n                        'place': function () {\n                            var img = document.createElement('img');\n                            img.onload = function () {\n                                revokeUrl();\n                                finishWork();\n                            };\n                            img.src = url;\n                            d3.select(options.target).node().appendChild(img);\n                        }\n                    };\n                    // call exporter function\n                    exporters[exporter]();\n                });\n            }\n        }\n    };\n\n\n    // queue functions\n\n    // queue will wait until any asynchronous tasks are complete prior to calling the next fn()\n    function addToQueue(fn) {\n        if (working) {\n            queue.push(fn);\n        } else {\n            fn();\n        }\n    }\n\n    // call before starting an asynchronous task\n    function startWork() {\n        working = true;\n    }\n\n    // call after finishing an asynchronous task\n    function finishWork() {\n        working = false;\n\n        var fn = queue.shift();\n        if (fn) {\n            fn();\n        }\n    }\n\n\n    // check browser capabilities and set up necessary shims\n    function checkBrowser() {\n        startWork();\n        browser.checked = true;\n\n        checkEncodesBase64();\n        checkADownloads();\n        checkSavesMsBlobs();\n        checkCreatesObjectUrls();\n        checkExportsSvg(finishWork);\n\n\n        function checkEncodesBase64() {\n            browser.encodesBase64 = !!root.btoa;\n\n            // setup shim for IE9\n            if (!browser.encodesBase64) {\n                setupBase64Shim();\n            }\n        }\n\n        function checkADownloads() {\n            browser.aDownloads = document.createElement('a').download !== undefined;\n        }\n\n        function checkSavesMsBlobs() {\n            browser.savesMsBlobs = !!navigator.msSaveOrOpenBlob;\n        }\n\n        function checkCreatesObjectUrls() {\n            var domUrl = root.URL || root.webkitURL;\n            browser.createsObjectUrls = domUrl && domUrl.createObjectURL;\n        }\n\n        function checkExportsSvg() {\n            startWork();\n\n            browser.exportsSvg = false;\n\n            var iframe = document.body.appendChild(document.createElement('iframe'));\n            iframe.style.visibility = 'hidden';\n            var doc = iframe.contentWindow.document;\n\n            iframe.onload = function () {\n                try {\n                    var svg = doc.querySelector('svg');\n                    var img = doc.querySelector('img');\n                    var canvas = doc.querySelector('canvas');\n                    var context = canvas.getContext('2d');\n                    canvas.width = img.getAttribute('width') * 1;\n                    canvas.height = img.getAttribute('height') * 1;\n                    var sourceImg = new Image();\n                    sourceImg.width = canvas.width;\n                    sourceImg.height = canvas.height;\n                    sourceImg.onload = function () {\n                        try {\n                            context.drawImage(sourceImg, 0, 0, img.width, img.height);\n                            img.src = canvas.toDataURL();\n\n                            browser.exportsSvg = true; // yay\n                        } catch (e) {}\n\n                        svgExportChecked();\n                    };\n                    var xml = (new XMLSerializer()).serializeToString(svg);\n                    sourceImg.src = 'data:image/svg+xml,' + encodeURIComponent(xml);\n                } catch (e) {\n                    svgExportChecked();\n                }\n            };\n\n            doc.open();\n            doc.write('<!DOCTYPE html>');\n            doc.write('<html><head></head><body>');\n            doc.write('<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2\" height=\"2\" viewBox=\"0 0 1 1\"><circle r=\"1\" fill=\"red\"/></svg>');\n            doc.write('<img width=\"2\" height=\"2\">');\n            doc.write('<canvas></canvas>');\n            doc.write('</body></html>');\n            doc.close();\n\n\n            function svgExportChecked() {\n                document.body.removeChild(iframe);\n\n                // load Canvg SVG renderer for browsers that can't safely export SVG\n                if (browser.exportsSvg) {\n                    finishWork();\n                } else {\n                    setupCanvgShim(finishWork);\n                }\n            }\n        }\n\n        // base64 shim, for IE9\n        function setupBase64Shim() {\n            var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n            function InvalidCharacterError(message) {\n                this.message = message;\n            }\n            InvalidCharacterError.prototype = new Error();\n            InvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n            // base64 encoder\n            // from https://gist.github.com/999166\n            root.btoa = function (input) {\n                var str = String(input);\n                for (\n                    // initialize result and counter\n                    var block, charCode, idx = 0, map = chars, output = '';\n                    // if the next str index does not exist:\n                    //   change the mapping table to \"=\"\n                    //   check if d has no fractional digits\n                    str.charAt(idx | 0) || (map = '=', idx % 1);\n                    // \"8 - idx % 1 * 8\" generates the sequence 2, 4, 6, 8\n                    output += map.charAt(63 & block >> 8 - idx % 1 * 8)\n                ) {\n                    charCode = str.charCodeAt(idx += 3 / 4);\n                    if (charCode > 0xFF) {\n                        throw new InvalidCharacterError('\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.');\n                    }\n                    block = block << 8 | charCode;\n                }\n                return output;\n            };\n        }\n\n        // Canvg shim, for IE9-11 and Safari\n        function setupCanvgShim(done) {\n            var scripts = [\n                'rgbcolor.js',\n                'StackBlur.js',\n                'canvg.js'\n            ];\n            var remaining = scripts.length;\n            _.each(scripts, function (src) {\n                var script = document.createElement('script');\n                script.type = 'text/javascript';\n                script.onload = function () {\n                    remaining--;\n                    if (remaining === 0) done();\n                };\n                script.src = '//canvg.googlecode.com/svn/trunk/' + src;\n                document.head.appendChild(script);\n            });\n        }\n    }\n\n\n    Contour.expose('exportable', exportable);\n\n})();\n","Contour.version = '1.0.1';","(function () {\n\n    var helpers = {\n        xScaleFactory: function (data, options) {\n            // if we have dates in the x field of the data points\n            // we need a time scale, otherwise is an oridinal\n            // two ways to shape the data for time scale:\n            //  [{ x: date, y: 1}, {x: date, y: 2}]\n            //  [{ data: [ x: date, y: 1]}, {data: [x: date, y: 100]}]\n            // if we get no data, we return an ordinal scale\n            var isTimeData = options.xAxis.type === 'time' || (_.isArray(data) && data.length > 0 && data[0].data ?\n                data[0].data[0].x && _.isDate(data[0].data[0].x) :\n                _.isArray(data) && data.length > 0 && data[0].x && _.isDate(data[0].x));\n\n\n            if (isTimeData && options.xAxis.type !== 'ordinal') {\n                return new _.nw.axes.TimeScale(data, options);\n            }\n\n            if (!options.xAxis.categories && options.xAxis.type === 'linear') {\n                return new _.nw.axes.LinearScale(data, options);\n            }\n\n            return new _.nw.axes.OrdinalScale(data, options);\n        },\n\n        yScaleFactory: function (data, options, axisType, domain) {\n            var map = {\n                'log': _.nw.axes.LogYAxis,\n                'smart': _.nw.axes.SmartYAxis,\n                'linear': _.nw.axes.YAxis,\n                'centered': _.nw.axes.CenteredYAxis\n            };\n\n            if (!axisType) {\n                axisType = 'linear';\n            }\n\n            if (axisType === 'linear' && (options.yAxis.smartAxis || options.yAxis.scaling.type === 'smart')) {\n                axisType = 'smart';\n            }\n\n            if (axisType === 'linear' && options.yAxis.scaling.type === 'centered') {\n                axisType = 'centered';\n            }\n\n            if (map[axisType]) {\n                return new map[axisType](data, options, domain);\n            }\n\n            // try by namespace\n            if (_.nw.axes[axisType]) {\n                return new _.nw.axes[axisType](data, options, domain);\n            }\n\n            throw new Error('Unknown axis type: \"' + axisType + '\"');\n        }\n\n    };\n\n    _.nw = _.extend({}, _.nw, helpers);\n\n})();\n","(function () {\n    // focus on vertically centering data - zero anchor is ignored\n    var CenteredYAxis = function (data, options, domain) {\n        this.data = data;\n        this.options = options;\n        this.yMax = domain[0];\n        this.yMin = domain[1];\n        this.NUM_DECIMALS = 1;\n    };\n\n    var __super = _.nw.axes.YAxis.prototype;\n    CenteredYAxis.prototype = _.extend({}, __super, {\n        axis: function () {\n            var options = this.options.yAxis;\n            this.domain = this._scale.domain();\n            var numTicks = options.ticks || 5;\n            var axis = __super.axis.call(this);\n            var tickValues = this._extractYTickValues(options.min, options.max, numTicks);\n\n            return axis.ticks(numTicks)\n                .tickValues(tickValues)\n                .tickFormat(undefined);\n        },\n\n        setDomain: function (domain) {\n            var scaledDomain = this._getScaledDomain(domain);\n\n            this.yMin = scaledDomain[0];\n            this.yMax = scaledDomain[1];\n            this._scale.domain(scaledDomain);\n        },\n\n        _getScaledDomain: function(domain) {\n            var extent = d3.extent(domain);\n            var dataRange = extent[1] - extent[0];\n            var domainPadding = dataRange * 0.1;\n\n            var scaledMin = d3.round(extent[0] - domainPadding, this.NUM_DECIMALS);\n            var scaledMax = d3.round(extent[1] + domainPadding, this.NUM_DECIMALS);\n\n            return [scaledMin, scaledMax];\n        },\n\n         _extractYTickValues:  function(min, max, numTicks) {\n            var tickMin = min != null ? min : this.yMin;\n            var tickMax = max != null ? max : this.yMax;\n\n            var tickRange = tickMax - tickMin;\n            var tickSpacing = tickRange / numTicks;\n\n            var currentTick = tickMin;\n            var tickValues = [tickMin];\n            while (currentTick < tickMax) {\n                currentTick += tickSpacing;\n                tickValues.push(d3.round(currentTick, this.NUM_DECIMALS));\n            }\n            tickValues.push(tickMax);\n            \n            return tickValues;\n        }\n    });\n\n    _.nw.addAxis('CenteredYAxis', CenteredYAxis);\n})();","(function () {\n\n    function LinearScale(data, options) {\n        this.options = options;\n        this.data = data;\n\n        this.init();\n    }\n\n    LinearScale.prototype = {\n        init: function () {\n            delete this._scale;\n        },\n\n        /*jshint eqnull:true*/\n        scale: function (domain) {\n            this._domain = domain ? this._getAxisDomain(domain) : this._getAxisDomain(this.data);\n            this._scale = this._scale || d3.scale.linear();\n            this._scale.domain(this._domain);\n\n            if (this.options.xAxis.min == null && this.options.xAxis.max == null) {\n                this._scale.nice();\n            }\n\n            this._setRange();\n\n            return this._scale;\n        },\n\n        axis: function () {\n            var options = this.options.xAxis;\n            var formatLabel = options.labels.formatter || d3.format(options.labels.format || 'g');\n            var axis = d3.svg.axis()\n                .scale(this._scale)\n                .tickSize(options.innerTickSize, options.outerTickSize)\n                .tickPadding(options.tickPadding)\n                .tickFormat(function (d) {\n                    return _.isDate(d) ? d.getDate() : formatLabel(d);\n                });\n\n            var ticks = axis.scale().ticks();\n            var labelsFit = _.nw.doXLabelsFit(ticks, formatLabel, this.options);\n\n            if (options.firstAndLast) {\n                // show only first and last tick\n                axis.tickValues(_.nw.firstAndLast(this._domain));\n            } else if (options.tickValues) {\n                axis.tickValues(options.tickValues);\n            } else if (options.ticks != null) {\n                axis.ticks(options.ticks);\n            } else if (!labelsFit) {\n                var finalTicks = _.nw.getTicksThatFit(ticks, formatLabel, this.options);\n                axis.tickValues(finalTicks);\n                axis.ticks(finalTicks.length);\n\n            }\n\n            return axis;\n        },\n\n        update: function (domain, dataSrc) {\n            this.data = dataSrc;\n            this.scale(domain);\n        },\n\n        rangeBand: function () {\n            return 1;\n        },\n\n        postProcessAxis: function () {\n            return this;\n        },\n\n        _setRange: function () {\n            var rangeSize = !!this.options.chart.rotatedFrame ? this.options.chart.plotHeight : this.options.chart.plotWidth;\n            var range = !!this.options.chart.rotatedFrame ? [rangeSize, 0]  : [0, rangeSize];\n            return this._scale.range(range);\n        },\n\n        _getAxisDomain: function (domain) {\n            /*jshint eqnull: true*/\n            var optMin = this.options.xAxis.min;\n            var optMax = this.options.xAxis.max;\n            var extents = d3.extent(domain);\n\n            if (optMin == null && optMax == null) {\n                return extents;\n            }\n\n            if (optMin == null) {\n                return [Math.min(extents[0], optMax), optMax];\n            }\n\n            if (optMax == null) {\n                return [optMin, Math.max(extents[1], optMin)];\n            }\n\n            // options are invalid, use the extents\n            if (optMin > optMax) {\n                return extents;\n            }\n\n            return [optMin, optMax];\n        }\n    };\n\n    _.nw.addAxis('LinearScale', LinearScale );\n\n})();\n","(function () {\n\n    var LogYAxis = function (data, options) {\n        this.data = data;\n        this.options = options;\n    };\n\n    function setRange(scale, options) {\n        var rangeSize = options.chart.rotatedFrame ? options.chart.plotWidth : options.chart.plotHeight;\n        var range = options.chart.rotatedFrame ? [0, rangeSize] : [rangeSize, 0];\n        return scale.range(range);\n    }\n\n    var __super = _.nw.axes.YAxis.prototype;\n    LogYAxis.prototype = _.extend({}, __super, {\n        axis: function () {\n            var options = this.options.yAxis;\n            var domain = this._scale.domain();\n            var ticksHint = Math.ceil(Math.log(domain[1]) / Math.log(10));\n            var format = options.labels.formatter || d3.format(options.labels.format || ',.0f');\n\n            var axis = d3.svg.axis()\n                .scale(this._scale)\n                .tickSize(options.innerTickSize, options.outerTickSize)\n                .tickPadding(options.tickPadding);\n            if(options.labels.formatter) {\n                axis.tickFormat(options.labels.formatter);\n            } else {\n                axis.ticks(options.ticks || ticksHint, format);\n            }\n\n\n            return axis;\n        },\n\n        scale: function (domain) {\n            if(!this._scale) {\n                if(domain[0] <= 0.1) domain[0] = 0.1; //throw new Error('Log scales don\\'t support 0 or negative values');\n\n                this._scale = d3.scale.log();\n                this.setDomain(domain).clamp(true);\n\n            }\n\n            setRange(this._scale, this.options);\n\n            return this._scale;\n        },\n\n        update: function (domain, dataSrc) {\n            this.data = dataSrc;\n            if(domain[0] <= 0.1) domain[0] = 0.1; //throw new Error('Log scales don\\'t support 0 or negative values');\n            this.setDomain(domain).clamp(true);\n            this.scale();\n        },\n    });\n\n    _.nw.addAxis('LogYAxis', LogYAxis );\n\n})();\n","(function () {\n\n    // implements the following interface\n    /*\n    {\n        scale: returns the d3 scale for the type\n\n        axis: returns the d3 axis\n\n        range: returns the d3 range for the type\n\n        postProcessAxis:\n    }\n    */\n\n    function OrdinalScale(data, options) {\n        this.options = options;\n        this.data = data;\n\n        this.init();\n    }\n\n    OrdinalScale.prototype = {\n        init: function () {\n            this.isCategorized = true;\n            delete this._scale;\n        },\n\n        scale: function (domain) {\n            if(!this._scale) {\n                this._scale = new d3.scale.ordinal();\n            }\n\n            this.setDomain(domain || this.data);\n\n            return this._scale;\n        },\n\n        /* jshint eqnull:true */\n        axis: function () {\n            var options = this.options.xAxis;\n            var optFormat = (options.labels.format ? d3.format(options.labels.format) : 0);\n            var formatLabel = options.labels.formatter || d3.format(options.labels.format || 'g');\n\n            var tickFormat = options.labels.formatter || (!this.isCategorized ? optFormat : 0) || function (d) { return _.isDate(d) ? d.getDate() : d; };\n            var axis = d3.svg.axis()\n                .scale(this._scale)\n                .innerTickSize(options.innerTickSize)\n                .outerTickSize(options.outerTickSize)\n                .tickPadding(options.tickPadding)\n                .tickFormat(tickFormat);\n\n            var ticks = this.isCategorized && options.categories ? options.categories : _.range(this._domain.length) || [];\n            var labelsFit = _.nw.doXLabelsFit(ticks, formatLabel, this.options);\n\n            if (options.firstAndLast) {\n                // show only first and last tick\n                axis.tickValues(_.nw.firstAndLast(this._domain));\n            } else if (options.maxTicks) {\n                axis.tickValues(_.nw.maxTickValues(options.maxTicks, this._domain));\n            } else if (options.tickValues) {\n                axis.tickValues(options.tickValues);\n            } else if (options.ticks != null) {\n                axis.ticks(options.ticks);\n                if (options.ticks === 0) {\n                    axis.tickValues([]);\n                }\n            } else if (!labelsFit) {\n                var finalTicks = _.nw.getTicksThatFit(ticks, formatLabel, this.options);\n                axis.tickValues(finalTicks);\n                axis.ticks(finalTicks.length);\n            } else {\n                axis.tickValues(options.categories);\n            }\n\n            return axis;\n        },\n\n        /* jshint eqnull:true */\n        postProcessAxis: function (axisGroup) {\n            var options = this.options.xAxis;\n            if (!options.labels || options.labels.rotation == null) return;\n\n            var deg = options.labels.rotation;\n            var rad = _.nw.degToRad(deg);\n            var sign = deg > 0 ? 1 : deg < 0 ? -1 : 0;\n            var pos = deg < 0 ? -1 : 1;\n            var lineHeight = 0.71;\n            var lineCenter = lineHeight / 2; // center of text line is at .31em\n            var cos = Math.cos(rad);\n            var sin = Math.sin(rad);\n            var anchor = options.labels.rotation < 0 ? 'end' : options.labels.rotation > 0 ? 'start' : 'middle';\n\n            axisGroup.selectAll('.tick text')\n                .style({'text-anchor': anchor})\n                .attr('transform', function (d, i, j) {\n                    var x = d3.select(this).attr('x') || 0;\n                    var y = d3.select(this).attr('y') || 0;\n                    return 'rotate(' + options.labels.rotation + ' ' + x + ',' + y + ')';\n                })\n                .attr('dy', function (d, i, j) {\n                    var ref = deg === 0 ? lineHeight : lineCenter;\n                    var num = ((cos * ref) + (sin * ref * pos));\n                    return (num).toFixed(4) + 'em';\n                    // return (sign * ((cos * lineCenter) + (sin * lineCenter))).toFixed(4) + 'em';\n                })\n                .attr('dx', function (d, i, j) {\n                    // var num = ((sin * lineCenter * pos));\n                    // return -num.toFixed(4) + 'em';\n                    return -(sin * lineCenter - 0.31 * sign).toFixed(4) + 'em';\n\n                });\n        },\n\n        update: function (domain, data) {\n            this.data = data;\n            this.scale(domain);\n        },\n\n        setDomain: function (domain) {\n            this._domain = domain;\n            this._scale.domain(domain);\n            this._range();\n        },\n\n        rangeBand: function () {\n            var band = this._scale.rangeBand();\n            if (!band) _.nw.warn('rangeBand is 0, you may have too many points in in the domain for the size of the chart (ie. chartWidth = ' + this.options.chart.plotWidth + 'px and ' + (this._domain.length) + ' X-axis points (plus paddings) means less than 1 pixel per band and there\\'re no half pixels');\n\n            return this._scale.rangeBand();\n        },\n\n        _range: function () {\n            var range = this.options.chart.rotatedFrame ? [this.options.chart.plotHeight, 0] : [0, this.options.chart.plotWidth];\n            var numCats = (this._domain || []).length;\n            var threshold = 30;\n            var rangeType = numCats <= threshold ? 'rangeRoundBands' : 'rangeBands';\n\n            return this.isCategorized ?\n                // this._scale.rangeBands(range, this.options.xAxis.innerRangePadding, this.options.xAxis.outerRangePadding) :\n                this._scale[rangeType](range, this.options.xAxis.innerRangePadding, this.options.xAxis.outerRangePadding) :\n                this._scale.rangePoints(range);\n        }\n    };\n\n    _.nw.addAxis('OrdinalScale', OrdinalScale );\n\n})();\n","(function () {\n\n    var SmartYAxis = function (data, options, domain) {\n        this.data = data;\n        this.options = options;\n        this.yMax = domain[0];\n        this.yMin = domain[1];\n        this.dataMax = d3.max(_.map(data, 'y'));\n    };\n\n    /* jshint eqnull: true */\n    function _extractYTickValues(domain, min, max, yMin, yMax, dataMax) {\n        var adjustedDomain = _.uniq(_.nw.merge(_.nw.merge(domain, yMax), dataMax));\n        // we want to be able to remove parameters with default values\n        // so to remove the default yAxis.min: 0, you pass yAxis.min: null\n        // and for that we need to to a truly comparison here (to get null or undefined)\n        if (min == null && max == null)\n            return adjustedDomain;\n\n        if (min == null) {\n            return max > yMin ? _.nw.merge([max], adjustedDomain) : [max];\n        }\n\n        if (max == null) {\n            if (min >= yMax) return [min];\n            adjustedDomain[0] = min;\n\n            return adjustedDomain;\n        }\n\n        return _.nw.merge([min, max], yMax);\n    }\n\n    var __super = _.nw.axes.YAxis.prototype;\n    SmartYAxis.prototype = _.extend({}, __super, {\n        axis: function () {\n            var options = this.options.yAxis;\n            this.domain = this._scale.domain();\n            var tickValues = _extractYTickValues(this.domain, options.min, options.max, this.yMin, this.yMax, this.dataMax);\n            var numTicks = this.numTicks();\n            var axis = __super.axis.call(this);\n            return axis.ticks(numTicks)\n                .tickValues(tickValues);\n        },\n\n        numTicks: function () {\n            return 3;\n        },\n\n        setDomain: function (domain) {\n            var extent = d3.extent(domain);\n            this.yMin = extent[0];\n            this.yMax = extent[1];\n            this._scale.domain(domain);\n\n            this._niceTheScale();\n        },\n\n        _niceTheScale: function () {\n            var perTreshold = 0.05;\n            var domain = this._scale.domain();\n            var min = this.options.yAxis.min || domain[0];\n            var rawMax = this.options.yAxis.max || this.dataMax;\n            var nextTick = _.nw.roundToNextTick(rawMax);\n\n            var max = Math.abs(nextTick - rawMax) < rawMax * perTreshold ? _.nw.roundToNextTick(rawMax + rawMax * perTreshold) : nextTick;\n            // var max = nextTick === rawMax ? _.nw.roundToNextTick(rawMax + Math.pow(10, -_.nw.decDigits(rawMax) - 1)) : nextTick;\n            var nice = [min, max];\n            this._scale.domain(nice);\n        }\n    });\n\n    _.nw.addAxis('SmartYAxis', SmartYAxis );\n})();\n","(function () {\n\n    // implements the following interface\n    /*\n    {\n        scale: returns the d3 scale for the type\n\n        range: returns the d3 range for the type\n    }\n    */\n\n    function dateDiff(d1, d2) {\n        if (!d1 || !d2) return 0;\n        var diff = d1.getTime() - d2.getTime();\n        return diff / (24*60*60*1000);\n    }\n\n\n    function TimeScale(data, options) {\n        this.options = options;\n        this.data = data;\n\n        this.init();\n    }\n\n    TimeScale.prototype = {\n        init: function () {\n            delete this._scale;\n        },\n\n        scale: function (domain) {\n\n            if(!this._scale) {\n                this._scale = new d3.time.scale();\n                this.setDomain(domain);\n            }\n\n            this.range();\n\n            return this._scale;\n        },\n\n\n        /* jshint eqnull:true */\n        axis: function () {\n            var options = this.options.xAxis;\n            var tickFormat = this.getOptimalTickFormat();\n\n            var axis = d3.svg.axis()\n                .scale(this._scale)\n                .tickFormat(tickFormat)\n                .tickSize(options.innerTickSize, options.outerTickSize)\n                .tickPadding(options.tickPadding)\n                .tickValues(this._domain);\n\n            if (this.options.xAxis.tickValues != null) {\n                axis.tickValues(this.options.xAxis.tickValues);\n            } else if (this.options.xAxis.maxTicks != null && this.options.xAxis.maxTicks < this._domain.length) {\n                // override the tickValues with custom array based on number of ticks\n                // we don't use D3 ticks() because you cannot force it to show a specific number of ticks\n                axis.tickValues(_.nw.maxTickValues(options.maxTicks, this._domain));\n\n            } else if (this.options.xAxis.firstAndLast) {\n                // show only first and last tick\n                axis.tickValues(_.nw.firstAndLast(this._domain));\n            }\n\n            return axis;\n        },\n\n        update: function (domain, data) {\n            this.data = data;\n            this.setDomain(domain);\n            this.scale();\n        },\n\n        setDomain: function (domain) {\n            this._domain = domain;\n            var axisDomain = this._getAxisDomain(this._domain);\n            this._scale.domain(axisDomain);\n        },\n\n        postProcessAxis: function (axisGroup) {\n            if (!this.options.xAxis.firstAndLast) return;\n            var labels = axisGroup.selectAll('.tick text')[0];\n            d3.select(labels[0]).style({'text-anchor': 'start'});\n            d3.select(labels[labels.length - 1]).style({'text-anchor': 'end'});\n        },\n\n        rangeBand: function () {\n            return 4;\n        },\n\n        getOptimalTickFormat: function () {\n            if (this.options.xAxis.labels.formatter) return this.options.xAxis.labels.formatter;\n            if (this.options.xAxis.labels.format) return d3.time.format(this.options.xAxis.labels.format);\n\n            var spanDays = Math.abs(dateDiff(this._domain[this._domain.length-1], this._domain[0]));\n            var daysThreshold = this.options.xAxis.maxTicks || 1;\n            if (spanDays < daysThreshold) return d3.time.format('%H:%M');\n            if (spanDays < 365) return d3.time.format('%d %b');\n\n            return d3.time.format('%Y');\n        },\n\n        range: function () {\n            var range = this._getAxisRange(this._domain);\n            return this._scale.rangeRound(range, 0.1);\n        },\n\n\n        _getAxisDomain: function (domain) {\n            if(this.options.xAxis.linearDomain) {\n                return domain;\n            }\n\n            return d3.extent(domain);\n        },\n\n        _getAxisRange: function (domain) {\n            var size = this.options.chart.rotatedFrame ? this.options.chart.plotHeight : this.options.chart.plotWidth;\n\n            if(this.options.xAxis.linearDomain) {\n                return _.range(0, size, size / (domain.length - 1)).concat([size]);\n            }\n\n            return [0, size];\n        }\n    };\n\n    _.nw.addAxis('TimeScale', TimeScale );\n})();\n","(function () {\n\n    var defaults = {\n        chart: {\n            rotatedFrame: true,\n        },\n\n        xAxis: {\n            orient: 'left'\n        },\n\n        yAxis: {\n            orient: 'bottom'\n        }\n    };\n\n    var frame = {\n\n        init: function () {\n            _.merge(this.options, defaults);\n        },\n\n        adjustPadding: function () {\n            var categoryLabels = this.options.xAxis.categories || _.map(this.dataSrc, 'x');\n            var text = categoryLabels.join('<br>');\n            var xLabel = _.nw.textBounds(text, '.x.axis');\n            var yLabel = _.nw.textBounds('ABC', '.y.axis');\n            var maxTickSize = function (options) { return Math.max(options.outerTickSize, options.innerTickSize); };\n\n            this.options.chart.internalPadding.left = this.options.chart.padding.left || maxTickSize(this.options.xAxis) + this.options.xAxis.tickPadding + xLabel.width;\n            this.options.chart.internalPadding.bottom = this.options.chart.padding.bottom || maxTickSize(this.options.yAxis) + this.options.yAxis.tickPadding + yLabel.height;\n        },\n\n        adjustTitlePadding: function () {\n            var titleBounds;\n            if (this.options.xAxis.title || this.options.yAxis.title) {\n                if(this.options.xAxis.title) {\n                    titleBounds = _.nw.textBounds(this.options.xAxis.title, '.x.axis-title');\n                    this.options.chart.internalPadding.left += titleBounds.height + this.options.xAxis.titlePadding;\n                }\n\n                if(this.options.yAxis.title) {\n                    titleBounds = _.nw.textBounds(this.options.yAxis.title, '.y.axis-title');\n                    this.options.chart.internalPadding.bottom += titleBounds.height + this.options.yAxis.titlePadding;\n                }\n            }\n        },\n\n        renderYAxis: function () {\n            var yAxis = this.yAxis();\n            var x = this.options.chart.internalPadding.left;\n            var y = this.options.chart.padding.top + this.options.chart.plotHeight;\n\n            this._yAxisGroup = this.svg.selectAll('.y.axis')\n                .data([1]);\n\n            this._yAxisGroup.enter().append('g')\n                .attr('class', 'y axis')\n                .attr('transform', 'translate(' + x+ ',' + y + ')');\n\n            this._yAxisGroup.exit().remove();\n\n            this._yAxisGroup\n                    .transition().duration(this._animationDuration())\n                    .attr('transform', 'translate(' + x+ ',' + y + ')')\n                    .call(yAxis);\n\n            return this;\n        },\n\n        renderXAxis: function () {\n            var x = this.options.chart.internalPadding.left;\n            var y = this.options.chart.padding.top;\n            var xAxis = this.xAxis();\n\n            this._xAxisGroup = this.svg.selectAll('.x.axis')\n                .data([1]);\n\n            this._xAxisGroup.enter().append('g')\n                .attr('class', 'x axis')\n                .attr('transform', 'translate(' + x + ',' + y + ')');\n\n            this._xAxisGroup.exit().remove();\n\n           this._xAxisGroup\n                .transition().duration(this._animationDuration())\n                .attr('transform', 'translate(' + x + ',' + y + ')')\n                .call(xAxis);\n\n            this.xScaleGenerator.postProcessAxis(this._xAxisGroup);\n\n            return this;\n        },\n\n        renderAxisLabels: function () {\n            var lineHeightAdjustment = this.titleOneEm * 0.25; // add 25% of font-size for a complete line-height\n            var adjustFactor = 40/46.609;\n            var el;\n            var bounds, anchor, rotation, tickSize, x, y;\n\n            if (this.options.xAxis.title) {\n                bounds = _.nw.textBounds(this.options.xAxis.title, '.x.axis-title');\n                x = this.options.chart.rotatedFrame ? -bounds.height : this.options.chart.plotWidth;\n                y = this.options.chart.rotatedFrame ? -this.options.chart.internalPadding.left : this.options.chart.internalPadding.bottom - lineHeightAdjustment;\n\n                rotation = this.options.chart.rotatedFrame ? '-90' : '0';\n                el = this._xAxisGroup.selectAll('.x.axis-title').data([null]);\n\n                el.enter().append('text')\n                    .attr('class', 'x axis-title');\n\n                el.attr('x', 0)\n                    .attr('y', y)\n                    .attr('transform', ['rotate(', rotation, ')'].join(''))\n                    .attr('dy', bounds.height * adjustFactor)\n                    .attr('dx', -(this.options.chart.plotHeight + bounds.width) / 2)\n                    .text(this.options.xAxis.title);\n\n                el.exit().remove();\n            }\n\n            if (this.options.yAxis.title) {\n                bounds = _.nw.textBounds(this.options.yAxis.title, '.y.axis-title');\n                tickSize = Math.max(this.options.yAxis.innerTickSize, this.options.yAxis.outerTickSize);\n                anchor = this.options.chart.rotatedFrame ? 'end' : 'middle';\n                x = this.options.chart.rotatedFrame ? this.options.chart.plotWidth : 0;\n                y = this.options.chart.rotatedFrame ?\n                    this.options.chart.internalPadding.bottom:\n                    -this.options.chart.internalPadding.left + this.titleOneEm - lineHeightAdjustment;\n\n                rotation = this.options.chart.rotatedFrame ? '0' : '-90';\n\n                el = this._yAxisGroup.selectAll('.y.axis-title').data([null]);\n\n                el.enter().append('text')\n                    .attr('class', 'y axis-title');\n\n                el.attr('y', y)\n                    .attr('x', x)\n                    .attr('dx', -(this.options.chart.plotWidth + bounds.width) / 2)\n                    .attr('dy', -4) // just because\n                    .attr('transform', ['rotate(', rotation, ')'].join(''))\n                    .text(this.options.yAxis.title);\n\n                el.exit().remove();\n            }\n\n            return this;\n        }\n    };\n\n    /**\n    * Sets the visualization frame so that the xAxis is vertical and the yAxis is horizontal.\n    *\n    * This visualization requires `.cartesian()`.\n    *\n    * This visualization is a prerequiste for rendering bar charts (`.bar()`).\n    *\n    * ###Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *        .cartesian()\n    *        .horizontal()\n    *        .bar([1, 2, 3, 4, 5, 4, 3, 2, 1])\n    *        .render()\n    *\n    * @function horiztonal\n    */\n\n    Contour.expose('horizontal', frame);\n\n})();\n","(function () {\n\n    var _extent = function (series, field) {\n        var maxs = [], mins = [];\n        _.each(series, function (d) {\n            if(!d.data.length) return;\n            var values = _.map(d.data, field);\n            maxs.push(d3.max(values));\n            mins.push(d3.min(values));\n        });\n\n        //\n        if(!mins.length || !maxs.length) return [];\n\n        return [_.min(mins), _.max(maxs)];\n    };\n\n\n    /*jshint eqnull:true */\n    var _stackedExtent = function (data) {\n        var stack = _.nw.stackLayout();\n        var dataSets = stack(data);\n        var ext = [];\n        _.each(dataSets, function (set) {\n            _.each(set.data, function (d, i) {\n                var cur = ext[i] || 0;\n                ext[i] = cur + d.y;\n            });\n        });\n\n        return [_.min(ext), _.max(ext)];\n    };\n\n    var _xExtent = _.partialRight(_extent, 'x');\n    var _yExtent = _.partialRight(_extent, 'y');\n\n    function VisInstanceContainer(data, categories, options, type, renderer, context) {\n        this.type = type;\n        this.renderer = renderer;\n        this.ctx = context;\n        this.categories = categories;\n\n        this.init(data, options);\n    }\n\n    VisInstanceContainer.prototype = {\n\n        init: function (data, options) {\n            // set the options first and then the data\n            this.setOptions(options);\n            this.setData(data);\n        },\n\n        render: function (layer, options) {\n            this.renderer.call(this.ctx, this.data, layer, options);\n\n            return this.ctx;\n        },\n\n        setData: function (data) {\n            var normalizeData = (this.ctx || {}).dataNormalizer || _.nw.normalizeSeries;\n            this.data = normalizeData(data, this.categories);\n            this._updateDomain();\n\n            return this.ctx;\n        },\n\n        setOptions: function (options) {\n            var opt = {};\n            opt[this.type] = options || {};\n            this.options = {};\n            this.options = _.merge({}, (this.renderer || {}).defaults || {}, opt);\n\n            return this.ctx;\n        },\n\n        _updateDomain: function () {\n            if(!this.options[this.type]) throw new Error('Set the options before calling setData or _updateDomain');\n\n            var isSupportedFormat = (this.ctx || {}).isSupportedDataFormat || _.nw.isSupportedDataFormat;\n\n            if (isSupportedFormat(this.data)) {\n                this.xDomain = _.flatten(_.map(this.data, function (set) { return _.map(set.data, 'x'); }));\n                this.xExtent = _xExtent(this.data, 'x');\n                this.yExtent = this.options[this.type].stacked ? _stackedExtent(this.data) : _yExtent(this.data);\n            }\n        }\n\n    };\n\n    Contour.VisualizationContainer = VisInstanceContainer;\n\n})();\n","(function () {\n\n    var defaults = {\n        xAxis: {\n            type: 'linear'\n        },\n        area: {\n            stacked: true,\n            areaBase: undefined,\n            preprocess: _.nw.minMaxFilter(1000)\n        }\n    };\n\n    /* jshint eqnull:true */\n    function renderer(data, layer, options) {\n        this.checkDependencies('cartesian');\n        var duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        var x = _.bind(function (val) { return this.xScale(val) + this.rangeBand / 2 + 0.5; }, this);\n        var y = _.bind(function (val) { return this.yScale(val) + 0.5; }, this);\n        var h = options.chart.plotHeight;\n        var classFn = function (d, i) { return 'series s-' + (i+1) + ' ' + d.name; };\n        var stack = d3.layout.stack().values(function (d) { return d.data; });\n\n        var startArea = d3.svg.area()\n            .x(function(d) { return x(d.x); })\n            .y0(function (d) { return h; })\n            .y1(function(d) { return h; });\n\n        var areaBase = options.area.areaBase != null ? options.area.areaBase : options.yAxis.min;\n        var area = d3.svg.area()\n            .x(function(d) { return x(d.x); })\n            .y0(function (d) { return options.area.stacked ? y(d.y0 || areaBase || 0) : y(0); })\n            .y1(function(d) { return y((options.area.stacked ? d.y0 : 0) + d.y); });\n\n        if(options.area.smooth) {\n            area.interpolate('cardinal');\n            startArea.interpolate('cardinal');\n        }\n\n        renderSeries();\n\n        if (options.tooltip && options.tooltip.enable)\n            renderTooltipTrackers();\n\n        function renderSeries() {\n            data = options.area.preprocess(data);\n\n            var series = layer.selectAll('g.series')\n                    .data(stack(data));\n\n            series.enter()\n                .append('svg:g')\n                .attr('class', classFn)\n                .append('path').datum(function (d) { return d.data; })\n                    .attr('class', 'area')\n                    .attr('d', startArea);\n\n            series.exit().remove();\n\n            if (options.chart.animations && options.chart.animations.enable) {\n                series.select('.area')\n                    .datum(function (d) { return d.data; })\n                    .transition().duration(options.chart.animations.duration || duration)\n                    .attr('d', area);\n            } else {\n                series.select('.area')\n                    .datum(function (d) { return d.data; })\n                    .attr('d', area);\n            }\n        }\n\n        function renderTooltipTrackers() {\n            var trackerSize = 10;\n            // add the tooltip trackers regardless\n            var markers = layer.selectAll('.tooltip-trackers')\n                .data(data, function (d) { return d.name; });\n\n            markers.enter().append('g')\n                .attr('class', 'tooltip-trackers');\n\n            markers.exit().remove();\n\n            var blocks = markers.selectAll('.tooltip-tracker')\n                    .data(function (d) {\n                        return d.data;\n                    }, function (d, i) {\n                        return [d.x,d.y,d.y0].join('&');\n                    });\n\n            blocks.enter().append('rect')\n                    .attr('class', 'tooltip-tracker')\n                    .attr('opacity', 0)\n                    .attr('width', trackerSize * 2);\n\n            blocks.attr('x', function(d) { return x(d.x) - trackerSize; })\n                .attr('y', function(d) { return y((options.area.stacked ? d.y0 : 0) + d.y); })\n                .attr('height', function(d) { return y(0) - y(d.y); });\n\n            blocks.exit().remove();\n\n        }\n    }\n\n    renderer.defaults = defaults;\n\n    /**\n    * Adds an area chart to the Contour instance.\n    *\n    * Area charts are stacked by default when the _data_ includes multiple series.\n    *\n    * This visualization requires `.cartesian()`.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .area([1,2,3,4])\n    *           .render();\n    *\n    * @name area(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('area', renderer);\n\n})();\n","(function () {\n    /*jshint eqnull:true*/\n    var defaults = {\n        bar: {\n            barClass: null,\n            style: null,\n            stacked: false,\n            groupPadding: 2,      // two px between same group bars\n            barWidth: function() { return this.rangeBand; },\n            offset: function() { return 0; },\n            preprocess: function(data) {\n                return data;\n            }\n        }\n    };\n\n    function barRender(data, layer, options) {\n        this.checkDependencies(['cartesian', 'horizontal']);\n        var duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        var _this = this;\n        var opt = options.bar;\n        var rectClass = opt.barClass;\n        var style = opt.style;\n        var x = function (d) { return _this.xScale(d) - 0.5; };\n        var y = function (d) { return _this.yScale(d) + 0.5; };\n        var chartOffset = _.nw.getValue(opt.offset, 0, this);\n        var rangeBand = _.nw.getValue(opt.barWidth, this.rangeBand, this);\n        var stack = _.nw.stackLayout();\n        var update = options.bar.stacked ? stacked : grouped;\n        var enter = _.partialRight(update, true);\n        var classFn = function (d, i) { return 'series s-' + (i+1) + ' ' + d.name; };\n\n        data = options.bar.preprocess(data);\n        var series = layer.selectAll('g.series')\n            .data(stack(data));\n\n        series.enter().append('svg:g')\n            .attr('class', classFn);\n\n        series.exit().remove();\n\n        var bars = series.selectAll('.bar')\n            .data(function (d) { return d.data; });\n\n        var cssClass = 'bar' + (options.tooltip.enable ? ' tooltip-tracker' : '');\n        bars.enter().append('rect')\n            .attr('class', function (d, i, j) {\n                if (!rectClass) return cssClass;\n\n                return cssClass + ' ' + (typeof rectClass === 'function' ? rectClass.call(this, d, i, j) : rectClass);\n            })\n            .call(enter);\n\n        if(options.chart.animations && options.chart.animations.enable) {\n            bars\n                .attr('style', style)\n                .transition().duration(duration).call(update);\n            bars.exit()\n                .transition().duration(duration)\n                .attr('width', y(0))\n                .remove();\n        } else {\n            bars.attr('style', style).call(update);\n            bars.exit().remove();\n        }\n\n        function stacked(bar, enter) {\n            bar\n                .attr('y', function (d) { return x(d.x) + chartOffset; })\n                .attr('height', rangeBand);\n\n            if (enter) {\n                return bar\n                    .attr('x', function (d) { return y(0); })\n                    .attr('width', function (d) { return 0; });\n\n            } else {\n                return bar\n                    .attr('x', function (d) { return d.y >= 0 ? y(d.y0 || 0) : y(d.y + d.y0); })\n                    .attr('width', function (d) { return d.y >=0 ? y(d.y) - y(0) : y(0) - y(d.y); });\n            }\n        }\n\n        function grouped(bar, enter) {\n            var numSeries = data.length;\n            var height = function () { return rangeBand / numSeries - options.bar.groupPadding + 0.5; };\n            var offset = function (d, i) { return rangeBand / numSeries * i + 0.5; };\n\n            bar.attr('y', function (d, i, j) { return x(d.x) + offset(d, j) + chartOffset; })\n                .attr('x', y(0))\n                .attr('height', height);\n\n            if (enter) {\n                return bar\n                    .attr('width', function (d) { return 0.5; });\n            } else {\n                return bar\n                    .attr('width', function (d) { return d.y >= 0 ? y(d.y) - y(0) : y(0) - y(d.y); })\n                    .attr('x', function (d) { return d.y < 0 ? y(d.y) : y(0); });\n            }\n        }\n    }\n\n    barRender.defaults = defaults;\n    /**\n    * Adds a bar chart (horizontal columns) to the Contour instance.\n    *\n    * You can use this visualization to render both stacked and grouped charts (controlled through the _options_).\n    *\n    * This visualization requires `.cartesian()` and `.horizontal()`.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *       .cartesian()\n    *       .horizontal()\n    *       .bar([1,2,3,4])\n    *       .render();\n    *\n    * @name bar(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('bar', barRender);\n\n})();\n","(function () {\n\n    var defaults = {\n        column : {\n            // specifies a class string or function that will be added to each column\n            columnClass: null,\n            style: null,\n            stacked: false,\n            groupPadding: 1,\n            columnWidth: function() { return this.rangeBand; },\n            offset: function() { return 0; }\n        }\n    };\n\n    function render(data, layer, options) {\n        this.checkDependencies('cartesian');\n        var duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        var opt = options.column;\n        var h = options.chart.plotHeight;\n        var rectClass = options.column.columnClass;\n        var rectStyle = options.column.style;\n        var _this = this;\n        var x = function (v) { return Math.round(_this.xScale(v)) + 0.5; };\n        var y = function (v) { return Math.round(_this.yScale(v)) - 0.5; };\n        var dataKey = function (d) { return d.data; };\n        var chartOffset = _.nw.getValue(opt.offset, 0, this);\n        var rangeBand = _.nw.getValue(opt.columnWidth, this.rangeBand, this);\n        var enter = _.partialRight((options.column.stacked ? stacked : grouped), true);\n        var update = options.column.stacked ? stacked : grouped;\n        var filteredData = _.map(data, function (series, j) {\n            return {\n                name: series.name,\n                data: _.filter(series.data, function (d, i) {\n                    return i === 0 ? true : x(d.x) !== x(series.data[i-1].x);\n                })\n            };\n        });\n\n        var stack = _.nw.stackLayout();\n        var series = layer.selectAll('g.series')\n                .data(stack(filteredData));\n\n        series.enter()\n            .append('g')\n            .attr('class', function (d, i) { return 'series s-' + (i+1) + ' ' + d.name; });\n\n        series.exit()\n            .remove();\n\n        var cols = series.selectAll('.column')\n                .data(dataKey, function (d) { return d.x || d; });\n\n        var cssClass = 'column' + (options.tooltip.enable ? ' tooltip-tracker' : '');\n\n        cols.enter()\n            .append('rect')\n            .attr('class', function (d, i, j) {\n                if (!rectClass) return cssClass;\n\n                return cssClass + ' ' + (typeof rectClass === 'function' ? rectClass.call(this, d, i, j) : rectClass);\n            })\n            .call(enter);\n\n        if (options.chart.animations && options.chart.animations.enable) {\n            cols.exit()\n                .transition().duration(duration)\n                .attr('y', h)\n                .attr('height', function () { return 0.5; })\n                .remove();\n            cols.transition().duration(duration)\n                .call(update);\n        } else {\n            cols.exit().remove();\n            cols.call(update);\n        }\n\n        // for every update\n        cols.attr('style', rectStyle);\n\n        function stacked(col, enter) {\n            var base = y(0);\n\n            col.attr('x', function (d) { return x(d.x) + chartOffset; })\n                .attr('width', function () { return rangeBand; });\n\n            if (enter) {\n                col.attr('y', function (d) { return d.y >= 0 ? base : base; })\n                    .attr('height', function (d) { return 0.5; });\n            } else {\n                col.attr('y', function (d) { return d.y >= 0 ? y(d.y) + y(d.y0) - base : y(d.y0) ; })\n                    .attr('height', function (d) { return d.y >=0 ? base - y(d.y) : y(d.y) - base; });\n            }\n        }\n\n        function grouped(col, enter) {\n            var width = rangeBand / data.length - opt.groupPadding + 0.5;\n            var offset = function (d, i) { return rangeBand / data.length * i + 0.5; };\n            var base = y(0);\n\n            col.attr('x', function (d, i, j) { return x(d.x) + offset(d, j) + chartOffset; })\n                .attr('width', width);\n\n            if (enter) {\n                col.attr('y', base)\n                    .attr('height', 0);\n            } else {\n                col.attr('y', function (d) { return d.y >= 0 ? y(d.y) : base; })\n                    .attr('height', function (d) { return d.y >= 0 ? base - y(d.y) : y(d.y) - base; });\n            }\n        }\n    }\n\n    render.defaults = defaults;\n\n    /**\n    * Adds a column chart (vertical columns) to the Contour instance.\n    *\n    * This visualization requires `.cartesian()`.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .column([1,2,3,4])\n    *           .render();\n    *\n    * @name column(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('column', render);\n\n})();\n","(function () {\n\n    Contour.export('coolNarwhal', function (data, layer) {\n        layer.append('path')\n            .attr('class', 'cool')\n            .attr('opacity', 0)\n            .attr('transform', 'scale(.5) translate(500 150)')\n            .attr('d', 'M-220.02,76.509l-0.78,8.927c-0.956,10.949,1.389,20.422,6.188,30.383c10.203,21.173,63.095,84.05,93.72,115.075c20.145,20.406,19.487,23.018,21.549,40.122c2.487,20.621,24.897,66.462,40.838,71.269 c15.086,4.549,12.91-12.398,13.319-37.83c5.746,2.457,10.917,5.638,20.206,12.697c61.697,46.892,139.734,69.97,206.5,71.733c46.209,1.221,81.432-7.081,142.957-33.694c40.484-17.512,54.271-22.098,65.639-21.504c4.432,0.232,22.678,11.204,41.746,21.563c35.398,19.229,69.457,34.595,75.896,34.239c12.609-1.457-0.701-11.783-8.072-24.217c-7.049-11.892-15.414-29.572-18.844-42.134s-4.723-22.272-8.91-27.091c-2.143-2.463-12.812-6.786-21.189-8.146c-18.045-2.933-22.191-2.922-13.531-8.957c13.076-9.115,17.377-11.039,1.826-29.068c-6.383-7.402-11.336-20.003-13.709-39.542c-1.607-13.237,1.057-23.679-3.869-27.451s-17.271,12.341-20.846,19.334c-2.01,3.937-7.102,19.005-11.312,33.485c-13.795,47.427-29.865,65.742-62.693,71.447c-34.361,5.971-71.623-9.506-116.543-48.404c-13.164-11.399-29.533-25.26-39.254-36.913c-13.428-16.101-15.48-18.138-19.785-20.66c-16.166-9.472-54.98-31.694-103.525-63.815c-24.393-16.141-57.72-36.928-71.453-43.693c-27.236-13.417-68.416-28.952-90.731-46.771c-24.665-19.697-38.108-19.793-67.804-5.479c-21.429,10.328-23.941,15.298-26.52,15.726c-8.216-10.129-22.917-11.198-31.647-20.682c-9.529-10.35-28.027-14.098-37.824-24.957c-10.668-11.826-31.25-16.752-40.886-26.94c-11.339-11.989-29.387-16.096-40.838-26.637c-11.617-10.694-27.159-14.843-37.68-24.045c-10.383-9.082-23.187-12.538-31.408-19.163c-8.193-6.601-16.593-9.444-22.026-11.993c-5.433-2.549-7.398-2.522-7.658-1.927c-0.26,0.594,1.355,2.955,6.054,6.447c4.699,3.491,22.193,18.451,31.645,22.77c10.921,5.104,17.502,15.01,29.671,21.375c13.224,6.918,22.212,18.731,36.229,25.924c15.53,7.971,24.754,21.184,39.657,28.253c16.462,7.808,25.503,21.598,39.958,28.36c14.499,6.78,20.647,20.252,34.429,23.428C-238.033,58.207-227.932,70.443-220.02,76.509L-220.02,76.509z')\n            .transition()\n                .delay(300)\n                .duration(2000)\n                .attr('opacity', 1);\n    });\n\n})();\n","(function () {\n\n    var defaults = {\n        legend: {\n            vAlign: 'middle',\n            hAlign: 'right',\n            direction: 'vertical',\n            formatter: function (d) {\n                return d.name;\n            },\n            el: undefined\n        }\n    };\n\n    function validAlignmentClasses(options) {\n        var classes = [];\n        if (['top', 'middle', 'bottom'].indexOf(options.legend.vAlign) !== -1) {\n            classes.push(options.legend.vAlign);\n        } else {\n            classes.push('top');\n        }\n\n        if (['left', 'center', 'right'].indexOf(options.legend.hAlign) !== -1) {\n            classes.push(options.legend.hAlign);\n        } else {\n            classes.push('right');\n        }\n\n        if (options.legend.direction === 'vertical') {\n            classes.push('vertical');\n        }\n\n        return classes;\n    }\n\n    function Legend(data, layer, options) {\n        var container;\n        if (options.legend.el) {\n            container = d3.select(options.legend.el).node();\n            while (container.firstChild) {\n                container.removeChild(container.firstChild);\n            }\n        } else {\n            this.container.selectAll('.contour-legend').remove();\n        }\n        var em = _.nw.textBounds('series', '.contour-legend.contour-legend-entry');\n        var count = data.length;\n        var legendHeight = (em.height + 4) * count + 12; // legend has 1px border and 5px margin (12px) and each entry has ~2px margin\n        var mid = (options.chart.plotHeight - legendHeight) / 2;\n        var positioner = function (selection) {\n            // adjust position of legend only when is horizontally centered\n            // since we need to have all elements in the legend to calculate its width\n            if (options.legend.hAlign !== 'center' || !selection.length) {\n                return ;\n            }\n\n            // adjust the left\n            var legendWidth = selection[0].parentNode.clientWidth;\n            var left = (options.chart.plotWidth - legendWidth) / 2 + options.chart.internalPadding.left;\n\n            d3.select(selection[0].parentNode)\n                .style('left', left + 'px');\n        };\n\n        if (options.legend.el) {\n            container = d3.select(options.legend.el);\n        } else {\n            var legend = this.container.selectAll('.contour-legend').data([null]);\n            container = legend.enter().append('div');\n        }\n\n        container.attr('class', function () {\n            return ['contour-legend'].concat(validAlignmentClasses(options)).join(' ');\n        });\n\n        container.attr('style', function () {\n            var styles = [];\n\n            if (options.legend.vAlign === 'top') {\n                styles.push('top: 0');\n            } else if (options.legend.vAlign === 'middle') {\n                styles.push('top: ' + mid + 'px');\n            } else {\n                styles.push('bottom: ' + (options.chart.internalPadding.bottom + 5) + 'px');\n            }\n\n            if (options.legend.hAlign === 'left') {\n                styles.push('left: ' + options.chart.plotLeft + 'px');\n            } else if (options.legend.hAlign === 'center') {\n                var bounds = _.nw.textBounds(this, '.contour-legend');\n\n                styles.push('left: ' + ((options.chart.plotWidth - bounds.width) / 2 + options.chart.internalPadding.left) + 'px' );\n            } else {\n                styles.push('right: 10px');\n            }\n\n            return styles.join(';');\n        });\n\n        var entries = container.selectAll('.contour-legend-entry')\n            .data(data);\n\n        entries.enter()\n            .append('div')\n            .attr('class', function () {\n                return 'contour-legend-entry';\n            });\n\n        entries.append('span')\n            .attr('class', function (d, i) { return 'contour-legend-key series s-' + (i+1) + ' ' + _.nw.seriesNameToClass(d.name); });\n\n        entries.append('span')\n            .attr('class', 'series-name')\n            .text(options.legend.formatter)\n            .call(positioner);\n\n        entries.exit()\n            .remove();\n    }\n\n    Legend.defaults = defaults;\n\n    /**\n    * Adds a legend to the Contour instance. One entry is added to the legend for each series in the data.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .column(data)\n    *           .legend(data)\n    *           .render();\n    *\n    * @name legend(data, options)\n    * @param {object|array} data The _data series_ for which to create a legend. This can be in any of the supported formats.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n\n    Contour.export('legend', Legend);\n\n})();\n","(function () {\n\n    var defaults = {\n        xAxis: {\n            type: 'linear'\n        },\n        line: {\n            stacked: false,\n            smooth: false,\n            animationDirection: 'left-to-right',\n            // animationDirection: 'bottom-to-top',\n            marker: {\n                enable: true,\n                size: 3,\n                animationDelay: null\n            },\n            preprocess: _.nw.minMaxFilter(1000)\n        }\n    };\n\n    var duration;\n    var animationDirection;\n    var animationsMap = {\n        'left-to-right': {\n            enter: function (line) {\n                var path = this;\n                path.each(function () {\n                    var totalLength = this.getTotalLength();\n                    d3.select(this)\n                        .attr('stroke-dasharray', totalLength + ' ' + totalLength)\n                        .attr('stroke-dashoffset', totalLength)\n                        .transition().duration(duration).ease('linear')\n                            .attr('stroke-dashoffset', 0)\n                            .transition().duration(0)\n                                .attr('stroke-dasharray', undefined);\n                });\n            },\n\n            update: function (line) {\n                this.attr('d', function (d) { return line(d.data); });\n                this.each(function () {\n                    var totalLength = this.getTotalLength();\n                    d3.select(this)\n                        .attr('stroke-dasharray', totalLength + ' ' + totalLength)\n                        .attr('stroke-dashoffset', totalLength)\n                        .transition().duration(duration).ease('linear')\n                            .attr('stroke-dashoffset', 0)\n                            .transition().duration(0)\n                                .attr('stroke-dasharray', undefined);\n                });\n            }\n        },\n\n        'bottom-to-top': {\n            enter: function (line) {\n                this.transition().duration(duration)\n                    .attr('d', function (d) { return line(d.data); });\n            },\n\n            update: function (line) {\n                this.transition().duration(duration)\n                    .attr('d', function (d) { return line(d.data); });\n            }\n        }\n    };\n\n\n    /* jshint eqnull: true */\n    function render(rawData, layer, options, id) {\n        this.checkDependencies('cartesian');\n\n        var x = _.bind(function (d) { return this.xScale(d.x) + this.rangeBand / 2 + 0.5; }, this);\n        var y = _.bind(function (d) { return this.yScale(d.y + (d.y0 || 0)) + 0.5; }, this);\n        var shouldAnimate = options.chart.animations && options.chart.animations.enable;\n        animationDirection = options.line.animationDirection || 'left-to-right';\n        duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        // jshint eqnull:true\n        var data = options.line.preprocess(_.nw.cleanNullValues()(rawData));\n\n        data = options.line.stacked ? d3.layout.stack().values(function (d) { return d.data; })(data) : data;\n\n        renderPaths();\n\n        if (options.line.marker.enable)\n            renderMarkers();\n\n        if (options.tooltip && options.tooltip.enable)\n            renderTooltipTrackers();\n\n        function seriesClassName(extras) { return function (d, i) { return (extras||'') + ' s-' +(i+1) + ' ' + _.nw.seriesNameToClass(d.name); }; }\n\n        function renderPaths() {\n            var startLine = d3.svg.line()\n                .x(function (d) { return x(d); })\n                .y(function () { return y({x: 0, y: options.yAxis.min || 0}); });\n\n            var line = d3.svg.line()\n                .x(function (d) { return x(d); })\n                .y(function (d) { return y(d); });\n\n            if(options.line.smooth) line.interpolate('cardinal');\n\n            var animFn = animationsMap[animationDirection];\n            var series = layer.selectAll('g.series')\n                    .data(data, function (d) { return d.name; });\n\n            // enter\n            var el = series.enter().append('svg:g')\n                .attr('class',seriesClassName('series'))\n                .append('path')\n                    .attr('class', 'line');\n\n            if (shouldAnimate) {\n                var startLineFn = animationDirection === 'left-to-right' ? line : startLine;\n                el.attr('d', function(d) { return startLineFn(d.data); })\n                    .call(_.partial(animFn.enter, line));\n            } else {\n                el.attr('d', function (d) { return line(d.data); });\n            }\n\n            // update\n            el = series\n                .attr('class', seriesClassName('series'))\n                .select('.line');\n\n            if (shouldAnimate) {\n                el.call(_.partial(animFn.update, line));\n            } else  {\n                el.attr('d', function (d) { return line(d.data); });\n            }\n\n            // remove\n            if (shouldAnimate) {\n                series.exit()\n                    .remove();\n            } else  {\n                series.exit().remove();\n            }\n        }\n\n        function renderMarkers() {\n            var animationDelay = (options.line.marker.animationDelay == null) ? duration : options.line.marker.animationDelay;\n            var markers = layer.selectAll('.line-chart-markers')\n                .data(data, function (d) { return d.name; });\n\n            markers.enter().append('g')\n                .attr('class', seriesClassName('line-chart-markers markers'));\n\n            markers.exit().remove();\n\n            var dots = markers.selectAll('.dot')\n                .data(function (d) { return d.data; }, function (d) { return d.x; });\n\n            if (shouldAnimate) {\n                dots.transition().delay(animationDelay).duration(duration)\n                    .attr('cx', x)\n                    .attr('cy', y)\n                    .attr('opacity', 1);\n            } else {\n                dots.attr('cx', x)\n                    .attr('cy', y)\n                    .attr('opacity', 1);\n            }\n\n\n            dots.enter().append('circle')\n                .attr('class', 'dot')\n                .attr('r', options.line.marker.size)\n                .attr('opacity', 0)\n                .attr('cx', x)\n                .attr('cy', y)\n                .transition().delay(animationDelay)\n                    .attr('opacity', 1);\n\n            dots.exit().remove();\n\n        }\n\n        function renderTooltipTrackers() {\n            var trackerSize = 10;\n            var markers = layer.selectAll('.tooltip-trackers')\n                .data(data, function (d) { return d.name; });\n\n            markers.enter().append('g')\n                .attr('class', seriesClassName('tooltip-trackers'));\n\n            markers.exit().remove();\n\n            var dots = markers.selectAll('.tooltip-tracker')\n                .data(function (d) { return d.data; }, function (d) { return d.x; });\n\n            dots.enter().append('circle')\n                .attr({\n                    'class': 'tooltip-tracker',\n                    'r': trackerSize,\n                    'opacity': 0\n                });\n\n            dots.attr({\n                'cx': x,\n                'cy': y\n            });\n\n            dots.exit().remove();\n        }\n\n        return this;\n    }\n\n    render.defaults = defaults;\n\n\n    /**\n    * Adds a line chart to the Contour instance.\n    *\n    * This visualization requires `.cartesian()`.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .line([1,2,3,4])\n    *           .render();\n    *\n    * @name line(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('line', render);\n\n})();\n","Contour.export('nullVis', _.noop);\n","(function () {\n\n    var defaults = {\n        pie: {\n            sliceClass: null,\n\n            style: null,\n\n            piePadding: {\n                left: null,\n                top: null,\n                right: null,\n                bottom: null\n            },\n\n            // inner and outer radius can be numbers of pixels if >= 1, percentage if > 0 && < 1 or functions\n\n            // inner radius as function will recive the outerRadius as parameter\n            // passing a value between 0 and 1 (non-inclusing), this value is interpreted as % of radius\n            // ie. outerRadius: 100, innerRadius: .8 would give a inner radius or 80 pixles\n            innerRadius: null,\n\n            // outer radius as function will recieve the proposed maximum radius for a pie\n            // passing a value between 0 and 1 (non-inclusing), this value is interpreted as % of width\n            // the default behavior is 50% of the mininum between with and height of the container (adjusted for padding)\n            outerRadius: null\n        }\n    };\n\n    function normalizePadding(options) {\n        if (_.isNumber(options.pie.piePadding)) {\n            return {\n                top: options.pie.piePadding,\n                left: options.pie.piePadding,\n                right: options.pie.piePadding,\n                bottom: options.pie.piePadding\n            };\n        }\n\n        return options.pie.piePadding;\n    }\n\n    function clampBounds(bounds, maxWidth, maxHeight) {\n        return {\n            top: _.nw.clamp(bounds.top, 0, maxHeight),\n            bottom: _.nw.clamp(bounds.bottom, 0, maxHeight),\n            left: _.nw.clamp(bounds.left, 0, maxWidth),\n            right: _.nw.clamp(bounds.right, 0, maxWidth)\n        };\n    }\n\n    function calcPadding(options) {\n        var padding = normalizePadding(options);\n        var w = options.chart.plotWidth;\n        var h = options.chart.plotHeight;\n\n        return clampBounds(padding, w, h);\n    }\n\n    function resolveValueUnits(value, ref) {\n        // resolve (0,1) interval to a percentage of the reference value\n        // otherwise as a pixel valie\n        return value > 0 && value < 1 ? ref * value : value;\n    }\n\n    function resolvePaddingUnits(padding, w, h) {\n        // if the value of padding is betweem 0 and 1 (non inclusing),\n        // interpret it as a percentage, otherwise as a pixel value\n        return {\n            top: resolveValueUnits(padding.top, h) || 5,\n            bottom: resolveValueUnits(padding.bottom, h) || 5,\n            left: resolveValueUnits(padding.left, w) || 5,\n            right: resolveValueUnits(padding.right, w) || 5\n        };\n    }\n\n    function renderer(data, layer, options) {\n        /*jshint eqnull:true */\n        var duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        var shouldAnimate = options.chart.animations && options.chart.animations.enable;\n        var w = options.chart.plotWidth, h = options.chart.plotHeight;\n        var padding = calcPadding.call(this, options);\n        var numSeries = data.length;\n        var style = options.pie.style;\n        var _this = this;\n        var shouldCenterX = _.every([options.pie.piePadding.left, options.pie.piePadding.right], function (d) { return d == null; });\n        var shouldCenterY = _.every([options.pie.piePadding.top, options.pie.piePadding.bottom], function (d) { return d == null; });\n        var pixelPadding = resolvePaddingUnits(padding, w, h);\n        // the reference size is the min between with and height of the container\n        var referenceSize = Math.min(w, h);\n\n        // for auto radius we need to take the min between the available with or height adjusted by padding and num series\n        var totalPadding = pixelPadding.left + (pixelPadding.right + pixelPadding.left) * (numSeries - 1) + pixelPadding.right;\n        var proposedRadius = Math.min(((w - totalPadding) / numSeries) / 2, (h - pixelPadding.top - pixelPadding.bottom) / 2);\n        var radius = resolveValueUnits(_.nw.getValue(options.pie.outerRadius, proposedRadius, this, proposedRadius, referenceSize), referenceSize);\n        // inner radius is a pixel value or % of the radius\n        var innerRadius = resolveValueUnits(_.nw.getValue(options.pie.innerRadius, 0, this, radius), radius);\n        var pieData = d3.layout.pie().value(function (d) { return d.y; }).sort(null);\n        var totalWidth = totalPadding + radius * numSeries * 2;\n        var outerPaddingLeft = shouldCenterX ? (w - totalWidth) / 2 : pixelPadding.left;\n        var centerY = h / 2;\n\n        var classFn = function (d, i, j) {\n            var baseClass = 'series arc' + (options.tooltip.enable ? ' tooltip-tracker' : '') + ' s-' + (i+1) + ' ' + d.data.x;\n\n            if (!options.pie.sliceClass) {\n                return baseClass;\n            }\n\n            return baseClass + ' ' + (typeof options.pie.sliceClass === 'function' ? options.pie.sliceClass.call(_this, d, i, j) : options.pie.sliceClass);\n        };\n\n        var translatePie = function (d,i) {\n            // calc the left side coord of the pie, including padding for the prevousous pies\n            var offsetX = outerPaddingLeft + (radius * 2 * i + (pixelPadding.right + pixelPadding.left) * i);\n            // calc the center of the pie starting from offsetX\n            var posY = shouldCenterY ? centerY : radius + pixelPadding.top;\n\n            return 'translate(' + (radius + offsetX) + ',' + (posY) + ')';\n        };\n\n        var pieGroup = layer.selectAll('g.pie-group')\n            .data(data);\n\n        pieGroup.enter().append('svg:g')\n            .attr('class', 'pie-group')\n            .attr('transform', translatePie)\n            .call(renderSeries);\n\n        pieGroup.exit().remove();\n\n        if (shouldAnimate) {\n            pieGroup\n                .call(renderSeries)\n                .transition().duration(duration/2)\n                .attr('transform', translatePie);\n        } else {\n            pieGroup.call(renderSeries)\n                .attr('transform', translatePie);\n        }\n\n        function renderSeries(group) {\n            var arc = d3.svg.arc()\n                .outerRadius(radius).innerRadius(innerRadius);\n\n            var startArc = d3.svg.arc()\n                .outerRadius(radius).innerRadius(innerRadius)\n                .startAngle(0).endAngle(0);\n\n            var pie = group.selectAll('path')\n                .data(function (d) { return pieData(d.data); }, function (d) { return d.data.x; });\n\n            pie.enter()\n                .append('path')\n                .attr('class', classFn)\n                .attr('d', function (d) { return startArc(d); })\n                .attr('style', style)\n                .each(function (d) { this._current = { startAngle: d.startAngle, endAngle: d.startAngle }; });\n\n\n            if (shouldAnimate) {\n                pie.exit()\n                    .remove();\n\n                pie.transition().duration(duration)\n                    .ease('cubic-in')\n                    .attrTween('d', arcTween);\n            } else {\n                pie.exit().remove();\n                pie.attr('d', arc);\n            }\n\n            // Store the displayed angles in _current.\n            // Then, interpolate from _current to the new angles.\n            // During the transition, _current is updated in-place by d3.interpolate.\n            // from http://bl.ocks.org/mbostock/1346410\n            function arcTween(a) {\n                var i = d3.interpolate(this._current, a);\n                this._current = i(0);\n                return function(t) {\n                    return arc(i(t));\n                };\n            }\n        }\n    }\n\n    renderer.defaults = defaults;\n\n\n    /**\n    * Adds a pie chart to the Contour instance.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .pie([1,2,3,4])\n    *           .render();\n    *\n    * @name pie(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats. The data elements are summed and then divided. In the example, `.pie([1,2,3,4])` makes four pie slices: 1/10, 2/10, 3/10, and 4/10.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('pie', renderer);\n\n})();\n","(function () {\n\n    var defaults = {\n        xAxis: {\n            type: 'linear'\n        },\n        scatter: {\n            radius: 4,\n            preprocess: function(data) {\n                return data;\n            }\n        }\n    };\n\n    function ScatterPlot(data, layer, options) {\n        this.checkDependencies('cartesian');\n        var duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        var shouldAnimate = options.chart.animations && options.chart.animations.enable;\n        var opt = options.scatter;\n        var halfRangeBand = this.rangeBand / 2;\n        var x = _.bind(function (d) { return this.xScale(d.x) + halfRangeBand; }, this);\n        var y = _.bind(function (d) { return this.yScale(d.y); }, this);\n        var h = options.chart.plotHeight;\n        var classFn = function (d, i) { return d.name + ' series s-' + (i+1); };\n\n        data = options.scatter.preprocess(data);\n        \n        var series = layer.selectAll('.series')\n            .data(data);\n\n        series.attr('class', classFn);\n\n        series.enter().append('svg:g')\n            .attr('class', classFn);\n\n        series.exit().remove();\n\n        var dots = series.selectAll('.dot')\n            .data(function (d) { return d.data; }, function (d) {\n                return options.scatter.dataKey ? d[options.scatter.dataKey] : d.x;\n            });\n\n        dots.enter().append('circle')\n                .attr('class', 'dot tooltip-tracker')\n                .attr('r', opt.radius)\n                .attr('cx', x)\n                .attr('cy', h);\n\n        if (shouldAnimate) {\n            dots.transition().duration(duration)\n                .attr('r', opt.radius)\n                .attr('cx', x)\n                .attr('cy', y);\n        } else {\n            dots.attr('r', opt.radius)\n                .attr('cx', x)\n                .attr('cy', y);\n        }\n\n\n        dots.exit().remove();\n    }\n\n    ScatterPlot.defaults = defaults;\n\n    /**\n    * Adds a scatter plot to the Contour instance.\n    *\n    * This visualization requires `.cartesian()`.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.chart'})\n    *           .cartesian()\n    *           .scatter([1,2,3,4])\n    *           .render();\n    *\n    * @name scatter(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('scatter', ScatterPlot);\n\n\n})();\n","(function () {\n    var defaults = {\n        tooltip: {\n            enable: true\n        }\n    };\n\n    /**\n    * Adds a tooltip and legend combination for stacked (multiple) series visualizations in the Contour instance.\n    * Requires a second display element (`<div>`) for the legend in the html.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .column(stackedColData)\n    *           .stackTooltip(stackedColData, {el: '.myChartLegend'})\n    *           .render();\n    *\n    * @name stackTooltip(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats.\n    * @param {object} options Configuration options particular to this visualization that override the defaults. Requires an `el` option with the selector of the container in which to render the tooltip.\n    * @api public\n    *\n    * ### Notes:\n    *\n    * Each Contour instance can only include one `stackTooltip` visualization.\n    */\n    function stackTooltip(data, layer, options) {\n\n        var valueFormatter = this.yAxis().tickFormat();\n        var tooltip = d3.select(options.stackTooltip.el);\n\n        tooltip.classed('stack-tooltip', true);\n\n        // jshint eqnull:true\n        var onMouseOver = function (d) {\n            var isNull = function (p) {\n                return !(p && p.y != null);\n            };\n            var mapFn = function (p, i) {\n                var index = _.isNumber(d.x) ? d.x : options.xAxis.categories.indexOf(d.x);\n                return !isNull(p.data[index]) ?\n                    { seriesName: p.name, value: p.data[index].y, cssClass: 's-' + (i+1) } :\n                    null;\n            };\n            var filtered = _.filter(_.map(data, mapFn), function (x) { return x; });\n            var text = _.map(filtered, function (t) { return '<span class=\"' + t.cssClass + '\"\">' + t.seriesName + ': ' + valueFormatter(t.value) + '</span>'; }).join(' / ');\n            tooltip.html(text).style({display: 'block'});\n        };\n\n        var onMouseOut = function (// datum\n                                    ) {\n            tooltip.html('');\n        };\n\n        this.svg.selectAll('.tooltip-tracker')\n            .on('mouseover.tooltip', onMouseOver.bind(this))\n            .on('mouseout.tooltip',  onMouseOut.bind(this));\n    }\n\n    stackTooltip.defaults = defaults;\n\n    Contour.export('stackTooltip', stackTooltip);\n\n})();\n","(function () {\n    var defaults = {\n        tooltip: {\n            enable: true,\n            animate: true,\n            opacity: 0.85,\n            showTime: 300,\n            hideTime: 500,\n            distance: 5,\n            formatter: undefined //defined in formatters array in getTooltipText()\n        }\n    };\n\n    function render(data, layer, options) {\n\n        var clearHideTimer = function () {\n            clearTimeout(this.tooltip.hideTimer);\n        };\n\n        var changeOpacity = function (opacity, delay) {\n            if(this.options.tooltip.animate) {\n                this.tooltipElement\n                    .transition().duration(delay)\n                        .style('opacity', opacity);\n            } else {\n                this.tooltipElement.style('opacity', opacity);\n            }\n        };\n\n        var positionTooltip = function (d) {\n            var pointOrCentroid = function () {\n                return d3.event.target.tagName === 'path' ? _.nw.getCentroid(d3.event.target) : d3.mouse(this.container.node());\n            };\n            var xScale = this.xScale;\n            var yScale = this.yScale;\n            var plotLeft = this.options.chart.plotLeft;\n            var plotWidth = this.options.chart.plotWidth;\n            var plotTop = this.options.chart.plotTop;\n            var plotHeight = this.options.chart.plotHeight;\n            var distance = this.options.tooltip.distance;\n            var width = parseFloat(this.tooltipElement.node().offsetWidth);\n            var height = parseFloat(this.tooltipElement.node().offsetHeight);\n            var pointX = xScale ? xScale(d.x) : pointOrCentroid.call(this)[0];\n            var pointY = yScale ? yScale(d.y) : pointOrCentroid.call(this)[1];\n            var alignedRight;\n\n            var clampPosition = function (pos) {\n                // Check outside plot area (left)\n                if (pos.x < plotLeft) {\n                    pos.x = plotLeft + distance;\n                }\n\n                // Check outside plot area (right)\n                if (pos.x + width > plotLeft + plotWidth) {\n                    pos.x -= (pos.x + width) - (plotLeft + plotWidth);\n                    // Don't overlap point\n                    pos.y = plotTop + pointY - (height + distance);\n                    alignedRight = true;\n                }\n\n                // Check outside the plot area (top)\n                if (pos.y < plotTop) {\n                    pos.y = plotTop + distance;\n\n                    // Don't overlap point\n                    if (alignedRight && pointY >= pos.y && pointY <= pos.y + height) {\n                        pos.y = pointY + plotTop + distance;\n                    }\n                }\n\n                // Check outside the plot area (bottom)\n                if (pos.y + height > plotTop + plotHeight) {\n                    pos.y = Math.max(plotTop, plotTop + plotHeight - (height + distance));\n                }\n\n                return pos;\n            };\n\n            var positioner = {\n                'vertical': function verticalPositioner() {\n                    var pos = {\n                        x: plotLeft + pointX - (distance + width),\n                        y: plotTop + pointY - (distance + height)\n                    };\n\n                    return clampPosition(pos);\n                },\n\n                'horizontal': function horizontalPositioner() {\n                    var pos = {\n                        x: plotLeft + pointY - (distance + width),\n                        y: plotTop + pointX - (distance + height)\n                    };\n\n                    return clampPosition(pos);\n                }\n            };\n\n            return options.chart.rotatedFrame ? positioner.horizontal() : positioner.vertical();\n\n        };\n\n        var onMouseOver = function (d) {\n            show.call(this, d);\n        };\n\n        var onMouseOut = function () {\n            changeOpacity.call(this, 0, this.options.tooltip.hideTime);\n        };\n\n        var getTooltipText = function (d, allPoints) {\n            function match() {\n                var params = Array.prototype.slice.call(arguments);\n                var list = params[0];\n                var rest = params.slice(1);\n\n                var response = _.map(list, function(fn) { return fn.apply(this, rest); }).concat([_.noop]);\n\n                return _.first(_.filter(response));\n            }\n\n            var options = this.options.tooltip;\n            var formatters = [\n                function (d) { return options.formatter ? _.partial(options.formatter, d, allPoints) : null; },\n                function (d) { return d.hasOwnProperty('x') ? _.partial(function (d) { return d.series + '<br>' + d.x + '<br>' + d.y; }, d) : null; },\n                function (d) { return d.data && d.data.hasOwnProperty('x') ? _.partial(function (d) { return d.series + '<br>' +  d.x + '<br>' + d.y; }, d.data) : null; },\n                function (d) { return d.hasOwnProperty('value') ? _.partial(function (d) { return d.value; }, d) : null;  },\n                function () { return function () { return 'NA'; }; }\n            ];\n\n\n            return match(formatters, d)();\n        };\n\n        var show = function (d) {\n            clearHideTimer.call(this);\n\n            var dataPoints = findOriginalDataPoint(d);\n\n            this.tooltipElement.select('.text').html(getTooltipText.call(this, d || dataPoints[0], dataPoints));\n\n            var pos = positionTooltip.call(this, d);\n\n            this.tooltipElement\n                .style('top', pos.y + 'px')\n                .style('left', pos.x + 'px');\n\n            changeOpacity.call(this, this.options.tooltip.opacity, this.options.tooltip.showTime);\n        };\n\n        function findOriginalDataPoint(d) {\n            var res = [];\n            _.each(data, function (series, seriesIndex) {\n                var name = series.name;\n                _.each(series.data, function (point) {\n                    if (point.x === d.x && d.y === point.y) {\n                        res.push(_.extend(point, { series: name, seriesIndex:seriesIndex }));\n                    }\n                });\n            });\n\n            return res;\n        }\n\n        this.tooltipElement = this.container\n            .style('position', 'relative')\n            .selectAll('.nw-tooltip').data([1]);\n\n        this.tooltipElement\n            .enter().append('div')\n            .attr('class', 'nw-tooltip')\n            .style('opacity', 0)\n            .append('div')\n                .attr('class', 'text');\n\n        this.svg.selectAll('.tooltip-tracker')\n            .on('mouseover.tooltip', onMouseOver.bind(this))\n            .on('mouseout.tooltip',  onMouseOut.bind(this));\n    }\n\n    render.defaults = defaults;\n\n\n    /**\n    * Adds a tooltip on hover to all other visualizations in the Contour instance.\n    *\n    * Although not strictly required, this visualization does not appear unless there are already one or more visualizations in this Contour instance for which to show the tooltips.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .line([2, 4, 3, 5, 7])\n    *           .tooltip()\n    *           .render();\n    *\n    * @name tooltip(data, options)\n    * @param {object|array} data Ignored!\n    * @param {object} options Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    * ### Notes:\n    *\n    * Each Contour instance can only include one `tooltip` visualization.\n    */\n    Contour.export('tooltip', render);\n\n\n})();\n\n\n","(function () {\n\n    function normalizeDataSet(dataSet) {\n        var all = _.flatten(_.pluck(dataSet, 'data'));\n        var isLinear = all.length && _.isNumber(all[0].x);\n        var normalizer = function (d, i) { return { x: i, y: d.y }; };\n\n        return isLinear ? all : _.map(all, normalizer);\n    }\n\n    function ctor(raw, layer, options) {\n        this.checkDependencies('cartesian');\n        var data = normalizeDataSet(raw);\n        var duration = options.chart.animations.duration != null ? options.chart.animations.duration : 400;\n        var shouldAnimate = options.chart.animations && options.chart.animations.enable;\n        var x = _.bind(function(d) { return this.xScale(d) + this.rangeBand / 2; }, this);\n        var y = _.bind(function(d) { return this.yScale(d); }, this);\n        var regression = _.nw.linearRegression(data);\n        var domain = d3.extent(this.xScale.domain());\n        var numericDomain = d3.extent(data, function(p) { return p.x; });\n        var lineY = function (x) { return regression.intercept + regression.slope * x; };\n\n        var line = layer.selectAll('.trend-line')\n            .data([1]);\n\n        if (isNaN(lineY(numericDomain[0])) || isNaN(lineY(numericDomain[1])) || isNaN(x(domain[0])) || isNaN(x(domain[1]))) {\n            line.remove();\n        } else {\n            line.enter().append('line')\n              .attr('class', 'trend-line')\n              .attr('x1', x(domain[0]))\n              .attr('y1', y(lineY(numericDomain[0])))\n              .attr('x2', x(domain[0]))\n              .attr('y2', y(lineY(numericDomain[0])));\n\n            line.exit().remove();\n\n            if (shouldAnimate) {\n                line = line.transition().duration(duration);\n            }\n\n            line.attr('x1', x(domain[0]))\n              .attr('y1', y(lineY(numericDomain[0])))\n              .attr('x2', x(domain[1]))\n              .attr('y2', y(lineY(numericDomain[1])));\n        }\n    }\n\n    ctor.defaults = {};\n\n    /**\n    * Adds a trend line to the Contour instance, based on linear regression.\n    *\n    * This visualization requires `.cartesian()`.\n    *\n    * ### Example:\n    *\n    *     new Contour({el: '.myChart'})\n    *           .cartesian()\n    *           .trendLine([2,4,3,5,7])\n    *           .render();\n    *\n    * @name trendLine(data, options)\n    * @param {object|array} data The _data series_ to be rendered with this visualization. This can be in any of the supported formats. A linear regression is performed on the _data series_ and the resulting trend line is displayed.\n    * @param {object} [options] Configuration options particular to this visualization that override the defaults.\n    * @api public\n    *\n    */\n    Contour.export('trendLine', ctor);\n\n})();\n"]}
